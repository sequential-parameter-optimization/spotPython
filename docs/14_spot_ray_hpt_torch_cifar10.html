<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Hyperparameter-tuning Cookbook - 13&nbsp; HPT: PyTorch With spotPython and Ray Tune on CIFAR10</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./16_spot_hpt_sklearn_multiclass_classification_randomforest.html" rel="next">
<link href="./12_spot_hpt_torch_cifar10.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script type="text/javascript">
window.PlotlyConfig = {MathJaxConfig: 'local'};
if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
if (typeof require !== 'undefined') {
require.undef("plotly");
requirejs.config({
    paths: {
        'plotly': ['https://cdn.plot.ly/plotly-2.20.0.min']
    }
});
require(['plotly'], function(Plotly) {
    window._Plotly = Plotly;
});
}
</script>


  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="twitter:title" content="Hyperparameter-tuning Cookbook - 13&nbsp; HPT: PyTorch With spotPython and Ray Tune on CIFAR10">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="./figures/14-torch_p040025_10min_5init_2023-06-07_12-41-06_tensorboard_01.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./14_spot_ray_hpt_torch_cifar10.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">HPT: PyTorch With `spotPython` and Ray Tune on CIFAR10</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Hyperparameter-tuning Cookbook</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/sequential-parameter-optimization/spotPython" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Hyperparameter-tuning-Cookbook.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_spot_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction: Hyperparameter Tuning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_spot_multidim.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Multi-dimensional Functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_spot_anisotropic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Isotropic and Anisotropic Kriging</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_spot_sklearn_surrogate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Using <code>sklearn</code> Surrogates in <code>spotPython</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_spot_sklearn_optimization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Sequential Parameter Optimization: Using <code>scipy</code> Optimizers</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_spot_gaussian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Sequential Parameter Optimization: Gaussian Process Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_spot_ei.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Expected Improvement</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_spot_noisy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Hyperparameter Tuning and Noise</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_spot_ocba.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Handling Noise: Optimal Computational Budget Allocation in <code>Spot</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_spot_hpt_sklearn_classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">HPT: sklearn SVC on Moons Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_spot_hpt_torch_fashion_mnist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">HPT: PyTorch With fashionMNIST</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_spot_hpt_torch_cifar10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">HPT: PyTorch With cifar10 Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_spot_ray_hpt_torch_cifar10.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">HPT: PyTorch With <code>spotPython</code> and Ray Tune on CIFAR10</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_spot_hpt_sklearn_multiclass_classification_randomforest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">HPT: sklearn RandomForestClassifier VBDP Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_spot_hpt_sklearn_multiclass_classification_xgb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">HPT: sklearn XGB Classifier VBDP Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18_spot_hpt_sklearn_multiclass_classification_svc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">HPT: sklearn SVC VBDP Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_spot_hpt_sklearn_multiclass_classification_knn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">HPT: sklearn KNN Classifier VBDP Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24_spot_torch_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">HPT PyTorch: Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25_spot_torch_vbdp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">HPT: PyTorch With VBDP</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99_spot_doc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Documentation of the Sequential Parameter Optimization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-setup-14" id="toc-sec-setup-14" class="nav-link active" data-scroll-target="#sec-setup-14"><span class="header-section-number">13.1</span> Setup</a></li>
  <li><a href="#sec-initialization-fun-control-14" id="toc-sec-initialization-fun-control-14" class="nav-link" data-scroll-target="#sec-initialization-fun-control-14"><span class="header-section-number">13.2</span> Initialization of the <code>fun_control</code> Dictionary</a></li>
  <li><a href="#sec-data-loading-14" id="toc-sec-data-loading-14" class="nav-link" data-scroll-target="#sec-data-loading-14"><span class="header-section-number">13.3</span> PyTorch Data Loading</a></li>
  <li><a href="#sec-the-model-to-be-tuned-14" id="toc-sec-the-model-to-be-tuned-14" class="nav-link" data-scroll-target="#sec-the-model-to-be-tuned-14"><span class="header-section-number">13.4</span> The Model (Algorithm) to be Tuned</a>
  <ul class="collapse">
  <li><a href="#sec-specification-of-preprocessing-model-14" id="toc-sec-specification-of-preprocessing-model-14" class="nav-link" data-scroll-target="#sec-specification-of-preprocessing-model-14"><span class="header-section-number">13.4.1</span> Specification of the Preprocessing Model</a></li>
  <li><a href="#sec-selection-of-the-algorithm" id="toc-sec-selection-of-the-algorithm" class="nav-link" data-scroll-target="#sec-selection-of-the-algorithm"><span class="header-section-number">13.4.2</span> Select <code>algorithm</code> and <code>core_model_hyper_dict</code></a></li>
  <li><a href="#sec-the-netcore-class-14" id="toc-sec-the-netcore-class-14" class="nav-link" data-scroll-target="#sec-the-netcore-class-14"><span class="header-section-number">13.4.3</span> The <code>Net_Core</code> class</a></li>
  <li><a href="#sec-comparison" id="toc-sec-comparison" class="nav-link" data-scroll-target="#sec-comparison"><span class="header-section-number">13.4.4</span> Comparison of the Approach Described in the PyTorch Tutorial With spotPython</a></li>
  </ul></li>
  <li><a href="#sec-search-space-14" id="toc-sec-search-space-14" class="nav-link" data-scroll-target="#sec-search-space-14"><span class="header-section-number">13.5</span> The Search Space: Hyperparameters</a>
  <ul class="collapse">
  <li><a href="#sec-configuring-the-search-space-with-ray-tune" id="toc-sec-configuring-the-search-space-with-ray-tune" class="nav-link" data-scroll-target="#sec-configuring-the-search-space-with-ray-tune"><span class="header-section-number">13.5.1</span> Configuring the Search Space With Ray Tune</a></li>
  <li><a href="#sec-configuring-search-space-spotpython-14" id="toc-sec-configuring-search-space-spotpython-14" class="nav-link" data-scroll-target="#sec-configuring-search-space-spotpython-14"><span class="header-section-number">13.5.2</span> Configuring the Search Space With spotPython</a></li>
  <li><a href="#sec-modification-of-hyperparameters-14" id="toc-sec-modification-of-hyperparameters-14" class="nav-link" data-scroll-target="#sec-modification-of-hyperparameters-14"><span class="header-section-number">13.5.3</span> Modifying the Hyperparameters</a></li>
  </ul></li>
  <li><a href="#sec-optimizers-14" id="toc-sec-optimizers-14" class="nav-link" data-scroll-target="#sec-optimizers-14"><span class="header-section-number">13.6</span> Optimizers</a></li>
  <li><a href="#sec-data-splitting-14" id="toc-sec-data-splitting-14" class="nav-link" data-scroll-target="#sec-data-splitting-14"><span class="header-section-number">13.7</span> Evaluation: Data Splitting</a>
  <ul class="collapse">
  <li><a href="#hold-out-data-split" id="toc-hold-out-data-split" class="nav-link" data-scroll-target="#hold-out-data-split"><span class="header-section-number">13.7.1</span> Hold-out Data Split</a></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation"><span class="header-section-number">13.7.2</span> Cross-Validation</a></li>
  <li><a href="#overview-of-the-evaluation-settings" id="toc-overview-of-the-evaluation-settings" class="nav-link" data-scroll-target="#overview-of-the-evaluation-settings"><span class="header-section-number">13.7.3</span> Overview of the Evaluation Settings</a></li>
  </ul></li>
  <li><a href="#sec-loss-functions-14" id="toc-sec-loss-functions-14" class="nav-link" data-scroll-target="#sec-loss-functions-14"><span class="header-section-number">13.8</span> Evaluation: Loss Functions and Metrics</a></li>
  <li><a href="#sec-prepare-spot-call-14" id="toc-sec-prepare-spot-call-14" class="nav-link" data-scroll-target="#sec-prepare-spot-call-14"><span class="header-section-number">13.9</span> Preparing the SPOT Call</a></li>
  <li><a href="#sec-the-objective-function-14" id="toc-sec-the-objective-function-14" class="nav-link" data-scroll-target="#sec-the-objective-function-14"><span class="header-section-number">13.10</span> The Objective Function <code>fun_torch</code></a></li>
  <li><a href="#sec-default-hyperparameters" id="toc-sec-default-hyperparameters" class="nav-link" data-scroll-target="#sec-default-hyperparameters"><span class="header-section-number">13.11</span> Using Default Hyperparameters or Results from Previous Runs</a></li>
  <li><a href="#sec-call-the-hyperparameter-tuner-14" id="toc-sec-call-the-hyperparameter-tuner-14" class="nav-link" data-scroll-target="#sec-call-the-hyperparameter-tuner-14"><span class="header-section-number">13.12</span> Starting the Hyperparameter Tuning</a></li>
  <li><a href="#sec-tensorboard-14" id="toc-sec-tensorboard-14" class="nav-link" data-scroll-target="#sec-tensorboard-14"><span class="header-section-number">13.13</span> Tensorboard</a>
  <ul class="collapse">
  <li><a href="#tensorboard-start-tensorboard" id="toc-tensorboard-start-tensorboard" class="nav-link" data-scroll-target="#tensorboard-start-tensorboard"><span class="header-section-number">13.13.1</span> Tensorboard: Start Tensorboard</a></li>
  <li><a href="#sec-saving-the-state-of-the-notebook" id="toc-sec-saving-the-state-of-the-notebook" class="nav-link" data-scroll-target="#sec-saving-the-state-of-the-notebook"><span class="header-section-number">13.13.2</span> Saving the State of the Notebook</a></li>
  </ul></li>
  <li><a href="#sec-results-14" id="toc-sec-results-14" class="nav-link" data-scroll-target="#sec-results-14"><span class="header-section-number">13.14</span> Results</a>
  <ul class="collapse">
  <li><a href="#sec-get-spot-results-14" id="toc-sec-get-spot-results-14" class="nav-link" data-scroll-target="#sec-get-spot-results-14"><span class="header-section-number">13.14.1</span> Get the Tuned Architecture (SPOT Results)</a></li>
  <li><a href="#get-default-hyperparameters" id="toc-get-default-hyperparameters" class="nav-link" data-scroll-target="#get-default-hyperparameters"><span class="header-section-number">13.14.2</span> Get Default Hyperparameters</a></li>
  <li><a href="#evaluation-of-the-default-architecture" id="toc-evaluation-of-the-default-architecture" class="nav-link" data-scroll-target="#evaluation-of-the-default-architecture"><span class="header-section-number">13.14.3</span> Evaluation of the Default Architecture</a></li>
  <li><a href="#evaluation-of-the-tuned-architecture" id="toc-evaluation-of-the-tuned-architecture" class="nav-link" data-scroll-target="#evaluation-of-the-tuned-architecture"><span class="header-section-number">13.14.4</span> Evaluation of the Tuned Architecture</a></li>
  <li><a href="#detailed-hyperparameter-plots" id="toc-detailed-hyperparameter-plots" class="nav-link" data-scroll-target="#detailed-hyperparameter-plots"><span class="header-section-number">13.14.5</span> Detailed Hyperparameter Plots</a></li>
  </ul></li>
  <li><a href="#sec-summary" id="toc-sec-summary" class="nav-link" data-scroll-target="#sec-summary"><span class="header-section-number">13.15</span> Summary and Outlook</a></li>
  <li><a href="#sec-appendix" id="toc-sec-appendix" class="nav-link" data-scroll-target="#sec-appendix"><span class="header-section-number">13.16</span> Appendix</a>
  <ul class="collapse">
  <li><a href="#sample-output-from-ray-tunes-run" id="toc-sample-output-from-ray-tunes-run" class="nav-link" data-scroll-target="#sample-output-from-ray-tunes-run"><span class="header-section-number">13.16.1</span> Sample Output From Ray Tune’s Run</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-hyperparameter-tuning-for-pytorch-14" class="quarto-section-identifier"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">HPT: PyTorch With <code>spotPython</code> and Ray Tune on CIFAR10</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>In this tutorial, we will show how <code>spotPython</code> can be integrated into the <code>PyTorch</code> training workflow. It is based on the tutorial “Hyperparameter Tuning with Ray Tune” from the <code>PyTorch</code> documentation <span class="citation" data-cites="pyto23a">(<a href="references.html#ref-pyto23a" role="doc-biblioref">PyTorch 2023a</a>)</span>, which is an extension of the tutorial “Training a Classifier” <span class="citation" data-cites="pyto23b">(<a href="references.html#ref-pyto23b" role="doc-biblioref">PyTorch 2023b</a>)</span> for training a CIFAR10 image classifier.</p>
<p>This document refers to the following software versions:</p>
<ul>
<li><code>python</code>: 3.10.10</li>
<li><code>torch</code>: 2.0.1</li>
<li><code>torchvision</code>: 0.15.0</li>
</ul>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pip <span class="bu">list</span> <span class="op">|</span> grep  <span class="st">"spot[RiverPython]"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>spotPython                 0.2.33
spotRiver                  0.0.93</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
</div>
<p><code>spotPython</code> can be installed via pip<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<pre class="{raw}"><code>!pip install spotPython</code></pre>
<ul>
<li>Uncomment the following lines if you want to for (re-)installation the latest version of <code>spotPython</code> from gitHub.</li>
</ul>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import sys</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># !{sys.executable} -m pip install --upgrade build</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># !{sys.executable} -m pip install --upgrade --force-reinstall spotPython</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Results that refer to the <code>Ray Tune</code> package are taken from <a href="https://PyTorch.org/tutorials/beginner/hyperparameter_tuning_tutorial.html">https://PyTorch.org/tutorials/beginner/hyperparameter_tuning_tutorial.html</a><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<section id="sec-setup-14" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="sec-setup-14"><span class="header-section-number">13.1</span> Setup</h2>
<p>Before we consider the detailed experimental setup, we select the parameters that affect run time, initial design size and the device that is used.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>MAX_TIME <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>INIT_SIZE <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>DEVICE <span class="op">=</span> <span class="st">"cpu"</span> <span class="co"># "cuda:0"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotPython.utils.device <span class="im">import</span> getDevice</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>DEVICE <span class="op">=</span> getDevice(DEVICE)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(DEVICE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>cpu</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> copy</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> socket</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dateutil.tz <span class="im">import</span> tzlocal</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>start_time <span class="op">=</span> datetime.now(tzlocal())</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>HOSTNAME <span class="op">=</span> socket.gethostname().split(<span class="st">"."</span>)[<span class="dv">0</span>]</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>experiment_name <span class="op">=</span> <span class="st">'14-torch'</span> <span class="op">+</span> <span class="st">"_"</span> <span class="op">+</span> HOSTNAME <span class="op">+</span> <span class="st">"_"</span> <span class="op">+</span> <span class="bu">str</span>(MAX_TIME) <span class="op">+</span> <span class="st">"min_"</span> <span class="op">+</span> <span class="bu">str</span>(INIT_SIZE) <span class="op">+</span> <span class="st">"init_"</span> <span class="op">+</span> <span class="bu">str</span>(start_time).split(<span class="st">"."</span>, <span class="dv">1</span>)[<span class="dv">0</span>].replace(<span class="st">' '</span>, <span class="st">'_'</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>experiment_name <span class="op">=</span> experiment_name.replace(<span class="st">':'</span>, <span class="st">'-'</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(experiment_name)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">'./figures'</span>):</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    os.makedirs(<span class="st">'./figures'</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>14-torch_p040025_30min_10init_2023-06-17_00-07-28</code></pre>
</div>
</div>
</section>
<section id="sec-initialization-fun-control-14" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="sec-initialization-fun-control-14"><span class="header-section-number">13.2</span> Initialization of the <code>fun_control</code> Dictionary</h2>
<p><code>spotPython</code> uses a Python dictionary for storing the information required for the hyperparameter tuning process. This dictionary is called <code>fun_control</code> and is initialized with the function <code>fun_control_init</code>. The function <code>fun_control_init</code> returns a skeleton dictionary. The dictionary is filled with the required information for the hyperparameter tuning process. It stores the hyperparameter tuning settings, e.g., the deep learning network architecture that should be tuned, the classification (or regression) problem, and the data that is used for the tuning. The dictionary is used as an input for the SPOT function.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotPython.utils.init <span class="im">import</span> fun_control_init</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>fun_control <span class="op">=</span> fun_control_init(task<span class="op">=</span><span class="st">"classification"</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    tensorboard_path<span class="op">=</span><span class="st">"runs/14_spot_ray_hpt_torch_cifar10"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    device<span class="op">=</span>DEVICE,)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-data-loading-14" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="sec-data-loading-14"><span class="header-section-number">13.3</span> PyTorch Data Loading</h2>
<p>The data loading process is implemented in the same manner as described in the Section “Data loaders” in <span class="citation" data-cites="pyto23a">PyTorch (<a href="references.html#ref-pyto23a" role="doc-biblioref">2023a</a>)</span>. The data loaders are wrapped into the function <code>load_data_cifar10</code> which is identical to the function <code>load_data</code> in <span class="citation" data-cites="pyto23a">PyTorch (<a href="references.html#ref-pyto23a" role="doc-biblioref">2023a</a>)</span>. A global data directory is used, which allows sharing the data directory between different trials. The method <code>load_data_cifar10</code> is part of the <code>spotPython</code> package and can be imported from <code>spotPython.data.torchdata</code>.</p>
<p>In the following step, the test and train data are added to the dictionary <code>fun_control</code>.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotPython.data.torchdata <span class="im">import</span> load_data_cifar10</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>train, test <span class="op">=</span> load_data_cifar10()</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>n_samples <span class="op">=</span> <span class="bu">len</span>(train)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># add the dataset to the fun_control</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>fun_control.update({</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"train"</span>: train,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"test"</span>: test,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"n_samples"</span>: n_samples})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Files already downloaded and verified</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Files already downloaded and verified</code></pre>
</div>
</div>
</section>
<section id="sec-the-model-to-be-tuned-14" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="sec-the-model-to-be-tuned-14"><span class="header-section-number">13.4</span> The Model (Algorithm) to be Tuned</h2>
<section id="sec-specification-of-preprocessing-model-14" class="level3" data-number="13.4.1">
<h3 data-number="13.4.1" class="anchored" data-anchor-id="sec-specification-of-preprocessing-model-14"><span class="header-section-number">13.4.1</span> Specification of the Preprocessing Model</h3>
<p>After the training and test data are specified and added to the <code>fun_control</code> dictionary, <code>spotPython</code> allows the specification of a data preprocessing pipeline, e.g., for the scaling of the data or for the one-hot encoding of categorical variables. The preprocessing model is called <code>prep_model</code> (“preparation” or pre-processing) and includes steps that are not subject to the hyperparameter tuning process. The preprocessing model is specified in the <code>fun_control</code> dictionary. The preprocessing model can be implemented as a <code>sklearn</code> pipeline. The following code shows a typical preprocessing pipeline:</p>
<pre class="{raw}"><code>categorical_columns = ["cities", "colors"]
one_hot_encoder = OneHotEncoder(handle_unknown="ignore",
                                    sparse_output=False)
prep_model = ColumnTransformer(
        transformers=[
             ("categorical", one_hot_encoder, categorical_columns),
         ],
         remainder=StandardScaler(),
     )</code></pre>
<p>Because the Ray Tune (<code>ray[tune]</code>) hyperparameter tuning as described in <span class="citation" data-cites="pyto23a">PyTorch (<a href="references.html#ref-pyto23a" role="doc-biblioref">2023a</a>)</span> does not use a preprocessing model, the preprocessing model is set to <code>None</code> here.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>prep_model <span class="op">=</span> <span class="va">None</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>fun_control.update({<span class="st">"prep_model"</span>: prep_model})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-selection-of-the-algorithm" class="level3" data-number="13.4.2">
<h3 data-number="13.4.2" class="anchored" data-anchor-id="sec-selection-of-the-algorithm"><span class="header-section-number">13.4.2</span> Select <code>algorithm</code> and <code>core_model_hyper_dict</code></h3>
<p>The same neural network model as implemented in the section “Configurable neural network” of the <code>PyTorch</code> tutorial <span class="citation" data-cites="pyto23a">(<a href="references.html#ref-pyto23a" role="doc-biblioref">PyTorch 2023a</a>)</span> is used here. We will show the implementation from <span class="citation" data-cites="pyto23a">PyTorch (<a href="references.html#ref-pyto23a" role="doc-biblioref">2023a</a>)</span> in <a href="#sec-implementation-with-raytune"><span>Section&nbsp;13.4.2.1</span></a> first, before the extended implementation with <code>spotPython</code> is shown in <span class="quarto-unresolved-ref">?sec-implementation-with-spotpython</span>.</p>
<section id="sec-implementation-with-raytune" class="level4" data-number="13.4.2.1">
<h4 data-number="13.4.2.1" class="anchored" data-anchor-id="sec-implementation-with-raytune"><span class="header-section-number">13.4.2.1</span> Implementing a Configurable Neural Network With Ray Tune</h4>
<p>We used the same hyperparameters that are implemented as configurable in the <code>PyTorch</code> tutorial. We specify the layer sizes, namely <code>l1</code> and <code>l2</code>, of the fully connected layers:</p>
<pre class="{raw}"><code>class Net(nn.Module):
    def __init__(self, l1=120, l2=84):
        super(Net, self).__init__()
        self.conv1 = nn.Conv2d(3, 6, 5)
        self.pool = nn.MaxPool2d(2, 2)
        self.conv2 = nn.Conv2d(6, 16, 5)
        self.fc1 = nn.Linear(16 * 5 * 5, l1)
        self.fc2 = nn.Linear(l1, l2)
        self.fc3 = nn.Linear(l2, 10)

    def forward(self, x):
        x = self.pool(F.relu(self.conv1(x)))
        x = self.pool(F.relu(self.conv2(x)))
        x = x.view(-1, 16 * 5 * 5)
        x = F.relu(self.fc1(x))
        x = F.relu(self.fc2(x))
        x = self.fc3(x)
        return x
</code></pre>
<p>The learning rate, i.e., <code>lr</code>, of the optimizer is made configurable, too:</p>
<pre class="{raw}"><code>optimizer = optim.SGD(net.parameters(), lr=config["lr"], momentum=0.9)</code></pre>
</section>
<section id="sec-implementation-with-spotpython-14" class="level4" data-number="13.4.2.2">
<h4 data-number="13.4.2.2" class="anchored" data-anchor-id="sec-implementation-with-spotpython-14"><span class="header-section-number">13.4.2.2</span> Implementing a Configurable Neural Network With spotPython</h4>
<p><code>spotPython</code> implements a class which is similar to the class described in the <code>PyTorch</code> tutorial. The class is called <code>Net_CIFAR10</code> and is implemented in the file <code>netcifar10.py</code>.</p>
<pre class="{raw}"><code>from torch import nn
import torch.nn.functional as F
import spotPython.torch.netcore as netcore


class Net_CIFAR10(netcore.Net_Core):
    def __init__(self, l1, l2, lr_mult, batch_size, epochs, k_folds, patience,
    optimizer, sgd_momentum):
        super(Net_CIFAR10, self).__init__(
            lr_mult=lr_mult,
            batch_size=batch_size,
            epochs=epochs,
            k_folds=k_folds,
            patience=patience,
            optimizer=optimizer,
            sgd_momentum=sgd_momentum,
        )
        self.conv1 = nn.Conv2d(3, 6, 5)
        self.pool = nn.MaxPool2d(2, 2)
        self.conv2 = nn.Conv2d(6, 16, 5)
        self.fc1 = nn.Linear(16 * 5 * 5, l1)
        self.fc2 = nn.Linear(l1, l2)
        self.fc3 = nn.Linear(l2, 10)

    def forward(self, x):
        x = self.pool(F.relu(self.conv1(x)))
        x = self.pool(F.relu(self.conv2(x)))
        x = x.view(-1, 16 * 5 * 5)
        x = F.relu(self.fc1(x))
        x = F.relu(self.fc2(x))
        x = self.fc3(x)
        return x</code></pre>
</section>
</section>
<section id="sec-the-netcore-class-14" class="level3" data-number="13.4.3">
<h3 data-number="13.4.3" class="anchored" data-anchor-id="sec-the-netcore-class-14"><span class="header-section-number">13.4.3</span> The <code>Net_Core</code> class</h3>
<p><code>Net_CIFAR10</code> inherits from the class <code>Net_Core</code> which is implemented in the file <code>netcore.py</code>. It implements the additional attributes that are common to all neural network models. The <code>Net_Core</code> class is implemented in the file <code>netcore.py</code>. It implements hyperparameters as attributes, that are not used by the <code>core_model</code>, e.g.:</p>
<ul>
<li>optimizer (<code>optimizer</code>),</li>
<li>learning rate (<code>lr</code>),</li>
<li>batch size (<code>batch_size</code>),</li>
<li>epochs (<code>epochs</code>),</li>
<li>k_folds (<code>k_folds</code>), and</li>
<li>early stopping criterion “patience” (<code>patience</code>).</li>
</ul>
<p>Users can add further attributes to the class. The class <code>Net_Core</code> is shown below.</p>
<pre class="{raw}"><code>from torch import nn


class Net_Core(nn.Module):
    def __init__(self, lr_mult, batch_size, epochs, k_folds, patience,
        optimizer, sgd_momentum):
        super(Net_Core, self).__init__()
        self.lr_mult = lr_mult
        self.batch_size = batch_size
        self.epochs = epochs
        self.k_folds = k_folds
        self.patience = patience
        self.optimizer = optimizer
        self.sgd_momentum = sgd_momentum</code></pre>
</section>
<section id="sec-comparison" class="level3" data-number="13.4.4">
<h3 data-number="13.4.4" class="anchored" data-anchor-id="sec-comparison"><span class="header-section-number">13.4.4</span> Comparison of the Approach Described in the PyTorch Tutorial With spotPython</h3>
<p>Comparing the class <code>Net</code> from the <code>PyTorch</code> tutorial and the class <code>Net_CIFAR10</code> from <code>spotPython</code>, we see that the class <code>Net_CIFAR10</code> has additional attributes and does not inherit from <code>nn</code> directly. It adds an additional class, <code>Net_core</code>, that takes care of additional attributes that are common to all neural network models, e.g., the learning rate multiplier <code>lr_mult</code> or the batch size <code>batch_size</code>.</p>
<p><code>spotPython</code>’s <code>core_model</code> implements an instance of the <code>Net_CIFAR10</code> class. In addition to the basic neural network model, the <code>core_model</code> can use these additional attributes. <code>spotPython</code> provides methods for handling these additional attributes to guarantee 100% compatibility with the <code>PyTorch</code> classes. The method <code>add_core_model_to_fun_control</code> adds the hyperparameters and additional attributes to the <code>fun_control</code> dictionary. The method is shown below.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotPython.torch.netcifar10 <span class="im">import</span> Net_CIFAR10</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotPython.data.torch_hyper_dict <span class="im">import</span> TorchHyperDict</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotPython.hyperparameters.values <span class="im">import</span> add_core_model_to_fun_control</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>core_model <span class="op">=</span> Net_CIFAR10</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>fun_control <span class="op">=</span> add_core_model_to_fun_control(core_model<span class="op">=</span>core_model,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                              fun_control<span class="op">=</span>fun_control,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>                              hyper_dict<span class="op">=</span>TorchHyperDict,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                              filename<span class="op">=</span><span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="sec-search-space-14" class="level2" data-number="13.5">
<h2 data-number="13.5" class="anchored" data-anchor-id="sec-search-space-14"><span class="header-section-number">13.5</span> The Search Space: Hyperparameters</h2>
<p>In <a href="#sec-configuring-the-search-space-with-ray-tune"><span>Section&nbsp;13.5.1</span></a>, we first describe how to configure the search space with <code>ray[tune]</code> (as shown in <span class="citation" data-cites="pyto23a">PyTorch (<a href="references.html#ref-pyto23a" role="doc-biblioref">2023a</a>)</span>) and then how to configure the search space with <code>spotPython</code> in <span class="quarto-unresolved-ref">?sec-configuring-the-search-space-with-spotpython</span>.</p>
<section id="sec-configuring-the-search-space-with-ray-tune" class="level3" data-number="13.5.1">
<h3 data-number="13.5.1" class="anchored" data-anchor-id="sec-configuring-the-search-space-with-ray-tune"><span class="header-section-number">13.5.1</span> Configuring the Search Space With Ray Tune</h3>
<p>Ray Tune’s search space can be configured as follows <span class="citation" data-cites="pyto23a">(<a href="references.html#ref-pyto23a" role="doc-biblioref">PyTorch 2023a</a>)</span>:</p>
<pre class="{raw}"><code>config = {
    "l1": tune.sample_from(lambda _: 2**np.random.randint(2, 9)),
    "l2": tune.sample_from(lambda _: 2**np.random.randint(2, 9)),
    "lr": tune.loguniform(1e-4, 1e-1),
    "batch_size": tune.choice([2, 4, 8, 16])
}</code></pre>
<p>The <code>tune.sample_from()</code> function enables the user to define sample methods to obtain hyperparameters. In this example, the <code>l1</code> and <code>l2</code> parameters should be powers of 2 between 4 and 256, so either 4, 8, 16, 32, 64, 128, or 256. The <code>lr</code> (learning rate) should be uniformly sampled between 0.0001 and 0.1. Lastly, the batch size is a choice between 2, 4, 8, and 16.</p>
<p>At each trial, <code>ray[tune]</code> will randomly sample a combination of parameters from these search spaces. It will then train a number of models in parallel and find the best performing one among these. <code>ray[tune]</code> uses the <code>ASHAScheduler</code> which will terminate bad performing trials early.</p>
</section>
<section id="sec-configuring-search-space-spotpython-14" class="level3" data-number="13.5.2">
<h3 data-number="13.5.2" class="anchored" data-anchor-id="sec-configuring-search-space-spotpython-14"><span class="header-section-number">13.5.2</span> Configuring the Search Space With spotPython</h3>
<section id="the-hyper_dict-hyperparameters-for-the-selected-algorithm" class="level4" data-number="13.5.2.1">
<h4 data-number="13.5.2.1" class="anchored" data-anchor-id="the-hyper_dict-hyperparameters-for-the-selected-algorithm"><span class="header-section-number">13.5.2.1</span> The <code>hyper_dict</code> Hyperparameters for the Selected Algorithm</h4>
<p><code>spotPython</code> uses <code>JSON</code> files for the specification of the hyperparameters. Users can specify their individual <code>JSON</code> files, or they can use the <code>JSON</code> files provided by <code>spotPython</code>. The <code>JSON</code> file for the <code>core_model</code> is called <code>torch_hyper_dict.json</code>.</p>
<p>In contrast to <code>ray[tune]</code>, <code>spotPython</code> can handle numerical, boolean, and categorical hyperparameters. They can be specified in the <code>JSON</code> file in a similar way as the numerical hyperparameters as shown below. Each entry in the <code>JSON</code> file represents one hyperparameter with the following structure: <code>type</code>, <code>default</code>, <code>transform</code>, <code>lower</code>, and <code>upper</code>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="er">"factor_hyperparameter":</span> <span class="fu">{</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"levels"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"A"</span><span class="ot">,</span> <span class="st">"B"</span><span class="ot">,</span> <span class="st">"C"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"factor"</span><span class="fu">,</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"default"</span><span class="fu">:</span> <span class="st">"B"</span><span class="fu">,</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"transform"</span><span class="fu">:</span> <span class="st">"None"</span><span class="fu">,</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"core_model_parameter_type"</span><span class="fu">:</span> <span class="st">"str"</span><span class="fu">,</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"lower"</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"upper"</span><span class="fu">:</span> <span class="dv">2</span><span class="fu">}</span><span class="er">,</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The corresponding entries for the <code>Net_CIFAR10</code> class are shown below.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">"Net_CIFAR10"</span><span class="fu">:</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"l1"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"int"</span><span class="fu">,</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"default"</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"transform"</span><span class="fu">:</span> <span class="st">"transform_power_2_int"</span><span class="fu">,</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"lower"</span><span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"upper"</span><span class="fu">:</span> <span class="dv">9</span><span class="fu">},</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"l2"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"int"</span><span class="fu">,</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"default"</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"transform"</span><span class="fu">:</span> <span class="st">"transform_power_2_int"</span><span class="fu">,</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"lower"</span><span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"upper"</span><span class="fu">:</span> <span class="dv">9</span><span class="fu">},</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"lr_mult"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"float"</span><span class="fu">,</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"default"</span><span class="fu">:</span> <span class="fl">1.0</span><span class="fu">,</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"transform"</span><span class="fu">:</span> <span class="st">"None"</span><span class="fu">,</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"lower"</span><span class="fu">:</span> <span class="fl">0.1</span><span class="fu">,</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"upper"</span><span class="fu">:</span> <span class="dv">10</span><span class="fu">},</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"batch_size"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"int"</span><span class="fu">,</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"default"</span><span class="fu">:</span> <span class="dv">4</span><span class="fu">,</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"transform"</span><span class="fu">:</span> <span class="st">"transform_power_2_int"</span><span class="fu">,</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"lower"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"upper"</span><span class="fu">:</span> <span class="dv">4</span><span class="fu">},</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"epochs"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"int"</span><span class="fu">,</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"default"</span><span class="fu">:</span> <span class="dv">3</span><span class="fu">,</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"transform"</span><span class="fu">:</span> <span class="st">"transform_power_2_int"</span><span class="fu">,</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"lower"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"upper"</span><span class="fu">:</span> <span class="dv">4</span><span class="fu">},</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"k_folds"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"int"</span><span class="fu">,</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"default"</span><span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"transform"</span><span class="fu">:</span> <span class="st">"None"</span><span class="fu">,</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"lower"</span><span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"upper"</span><span class="fu">:</span> <span class="dv">3</span><span class="fu">},</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"patience"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"int"</span><span class="fu">,</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"default"</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"transform"</span><span class="fu">:</span> <span class="st">"None"</span><span class="fu">,</span></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"lower"</span><span class="fu">:</span> <span class="dv">2</span><span class="fu">,</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"upper"</span><span class="fu">:</span> <span class="dv">10</span><span class="fu">},</span></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"optimizer"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"levels"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"Adadelta"</span><span class="ot">,</span></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Adagrad"</span><span class="ot">,</span></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Adam"</span><span class="ot">,</span></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"AdamW"</span><span class="ot">,</span></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"SparseAdam"</span><span class="ot">,</span></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Adamax"</span><span class="ot">,</span></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"ASGD"</span><span class="ot">,</span></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"LBFGS"</span><span class="ot">,</span></span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"NAdam"</span><span class="ot">,</span></span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"RAdam"</span><span class="ot">,</span></span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"RMSprop"</span><span class="ot">,</span></span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"Rprop"</span><span class="ot">,</span></span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"SGD"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"factor"</span><span class="fu">,</span></span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"default"</span><span class="fu">:</span> <span class="st">"SGD"</span><span class="fu">,</span></span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"transform"</span><span class="fu">:</span> <span class="st">"None"</span><span class="fu">,</span></span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"class_name"</span><span class="fu">:</span> <span class="st">"torch.optim"</span><span class="fu">,</span></span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"core_model_parameter_type"</span><span class="fu">:</span> <span class="st">"str"</span><span class="fu">,</span></span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"lower"</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"upper"</span><span class="fu">:</span> <span class="dv">12</span><span class="fu">},</span></span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"sgd_momentum"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"float"</span><span class="fu">,</span></span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"default"</span><span class="fu">:</span> <span class="fl">0.0</span><span class="fu">,</span></span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"transform"</span><span class="fu">:</span> <span class="st">"None"</span><span class="fu">,</span></span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"lower"</span><span class="fu">:</span> <span class="fl">0.0</span><span class="fu">,</span></span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a>            <span class="dt">"upper"</span><span class="fu">:</span> <span class="fl">1.0</span><span class="fu">}</span></span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="sec-modification-of-hyperparameters-14" class="level3" data-number="13.5.3">
<h3 data-number="13.5.3" class="anchored" data-anchor-id="sec-modification-of-hyperparameters-14"><span class="header-section-number">13.5.3</span> Modifying the Hyperparameters</h3>
<p>Ray tune <span class="citation" data-cites="pyto23a">(<a href="references.html#ref-pyto23a" role="doc-biblioref">PyTorch 2023a</a>)</span> does not provide a way to change the specified hyperparameters without re-compilation. However, <code>spotPython</code> provides functions for modifying the hyperparameters, their bounds and factors as well as for activating and de-activating hyperparameters without re-compilation of the Python source code. These functions are described in the following.</p>
<section id="sec-modification-of-default-values" class="level4" data-number="13.5.3.1">
<h4 data-number="13.5.3.1" class="anchored" data-anchor-id="sec-modification-of-default-values"><span class="header-section-number">13.5.3.1</span> Modify <code>hyper_dict</code> Hyperparameters for the Selected Algorithm aka <code>core_model</code></h4>
<p>After specifying the model, the corresponding hyperparameters, their types and bounds are loaded from the <code>JSON</code> file <code>torch_hyper_dict.json</code>. After loading, the user can modify the hyperparameters, e.g., the bounds. <code>spotPython</code> provides a simple rule for de-activating hyperparameters: If the lower and the upper bound are set to identical values, the hyperparameter is de-activated. This is useful for the hyperparameter tuning, because it allows to specify a hyperparameter in the <code>JSON</code> file, but to de-activate it in the <code>fun_control</code> dictionary. This is done in the next step.</p>
</section>
<section id="modify-hyperparameters-of-type-numeric-and-integer-boolean" class="level4" data-number="13.5.3.2">
<h4 data-number="13.5.3.2" class="anchored" data-anchor-id="modify-hyperparameters-of-type-numeric-and-integer-boolean"><span class="header-section-number">13.5.3.2</span> Modify Hyperparameters of Type numeric and integer (boolean)</h4>
<p>Since the hyperparameter <code>k_folds</code> is not used in the <code>PyTorch</code> tutorial, it is de-activated here by setting the lower and upper bound to the same value. Note, <code>k_folds</code> is of type “integer”.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotPython.hyperparameters.values <span class="im">import</span> modify_hyper_parameter_bounds</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>fun_control <span class="op">=</span> modify_hyper_parameter_bounds(fun_control, </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"batch_size"</span>, bounds<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">5</span>])</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>fun_control <span class="op">=</span> modify_hyper_parameter_bounds(fun_control, </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"k_folds"</span>, bounds<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>fun_control <span class="op">=</span> modify_hyper_parameter_bounds(fun_control, </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"patience"</span>, bounds<span class="op">=</span>[<span class="dv">3</span>, <span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modify-hyperparameter-of-type-factor" class="level4" data-number="13.5.3.3">
<h4 data-number="13.5.3.3" class="anchored" data-anchor-id="modify-hyperparameter-of-type-factor"><span class="header-section-number">13.5.3.3</span> Modify Hyperparameter of Type factor</h4>
<p>In a similar manner as for the numerical hyperparameters, the categorical hyperparameters can be modified. New configurations can be chosen by adding or deleting levels. For example, the hyperparameter <code>optimizer</code> can be re-configured as follows:</p>
<p>In the following setting, two optimizers (<code>"SGD"</code> and <code>"Adam"</code>) will be compared during the <code>spotPython</code> hyperparameter tuning. The hyperparameter <code>optimizer</code> is active.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotPython.hyperparameters.values <span class="im">import</span> modify_hyper_parameter_levels</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>fun_control <span class="op">=</span> modify_hyper_parameter_levels(fun_control,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>     <span class="st">"optimizer"</span>, [<span class="st">"SGD"</span>, <span class="st">"Adam"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The hyperparameter <code>optimizer</code> can be de-activated by choosing only one value (level), here: <code>"SGD"</code>.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fun_control <span class="op">=</span> modify_hyper_parameter_levels(fun_control, <span class="st">"optimizer"</span>, [<span class="st">"SGD"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As discussed in <a href="#sec-optimizers-14"><span>Section&nbsp;13.6</span></a>, there are some issues with the LBFGS optimizer. Therefore, the usage of the LBFGS optimizer is not deactivated in <code>spotPython</code> by default. However, the LBFGS optimizer can be activated by adding it to the list of optimizers. <code>Rprop</code> was removed, because it does perform very poorly (as some pre-tests have shown). However, it can also be activated by adding it to the list of optimizers. Since <code>SparseAdam</code> does not support dense gradients, <code>Adam</code> was used instead. Therefore, there are 10 default optimizers:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>fun_control <span class="op">=</span> modify_hyper_parameter_levels(fun_control, <span class="st">"optimizer"</span>,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"Adadelta"</span>, <span class="st">"Adagrad"</span>, <span class="st">"Adam"</span>, <span class="st">"AdamW"</span>, <span class="st">"Adamax"</span>, <span class="st">"ASGD"</span>, </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NAdam"</span>, <span class="st">"RAdam"</span>, <span class="st">"RMSprop"</span>, <span class="st">"SGD"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="sec-optimizers-14" class="level2" data-number="13.6">
<h2 data-number="13.6" class="anchored" data-anchor-id="sec-optimizers-14"><span class="header-section-number">13.6</span> Optimizers</h2>
<p><a href="#tbl-optimizers">Table&nbsp;<span>13.1</span></a> shows some of the optimizers available in <code>PyTorch</code>:</p>
<p><span class="math inline">\(a\)</span> denotes (0.9,0.999), <span class="math inline">\(b\)</span> (0.5,1.2), and <span class="math inline">\(c\)</span> (1e-6, 50), respectively. <span class="math inline">\(R\)</span> denotes <code>required, but unspecified</code>. “m” denotes <code>momentum</code>, “w_d” <code>weight_decay</code>, “d” <code>dampening</code>, “n” <code>nesterov</code>, “r” <code>rho</code>, “l_s” <code>learning rate for scaling delta</code>, “l_d” <code>lr_decay</code>, “b” <code>betas</code>, “l” <code>lambd</code>, “a” <code>alpha</code>, “m_d” for <code>momentum_decay</code>, “e” <code>etas</code>, and “s_s” for <code>step_sizes</code>.</p>
<div id="tbl-optimizers" class="anchored">
<table class="table">
<caption>Table&nbsp;13.1: Optimizers available in PyTorch (selection). The default values are shown in the table.</caption>
<colgroup>
<col style="width: 20%">
<col style="width: 7%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Optimizer</th>
<th style="text-align: left;">lr</th>
<th style="text-align: left;">m</th>
<th style="text-align: left;">w_d</th>
<th style="text-align: left;">d</th>
<th style="text-align: left;">n</th>
<th style="text-align: left;">r</th>
<th style="text-align: left;">l_s</th>
<th style="text-align: left;">l_d</th>
<th style="text-align: left;">b</th>
<th style="text-align: left;">l</th>
<th style="text-align: left;">a</th>
<th style="text-align: left;">m_d</th>
<th style="text-align: left;">e</th>
<th style="text-align: left;">s_s</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Adadelta</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.9</td>
<td style="text-align: left;">1.</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adagrad</td>
<td style="text-align: left;">1e-2</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adam</td>
<td style="text-align: left;">1e-3</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;"><span class="math inline">\(a\)</span></td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
</tr>
<tr class="even">
<td style="text-align: left;">AdamW</td>
<td style="text-align: left;">1e-3</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">1e-2</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;"><span class="math inline">\(a\)</span></td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SparseAdam</td>
<td style="text-align: left;">1e-3</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;"><span class="math inline">\(a\)</span></td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adamax</td>
<td style="text-align: left;">2e-3</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;"><span class="math inline">\(a\)</span></td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ASGD</td>
<td style="text-align: left;">1e-2</td>
<td style="text-align: left;">.9</td>
<td style="text-align: left;">0.</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">1e-4</td>
<td style="text-align: left;">.75</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
</tr>
<tr class="even">
<td style="text-align: left;">LBFGS</td>
<td style="text-align: left;">1.</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NAdam</td>
<td style="text-align: left;">2e-3</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;"><span class="math inline">\(a\)</span></td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
</tr>
<tr class="even">
<td style="text-align: left;">RAdam</td>
<td style="text-align: left;">1e-3</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;"><span class="math inline">\(a\)</span></td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RMSprop</td>
<td style="text-align: left;">1e-2</td>
<td style="text-align: left;">0.</td>
<td style="text-align: left;">0.</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;"><span class="math inline">\(a\)</span></td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rprop</td>
<td style="text-align: left;">1e-2</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;"><span class="math inline">\(b\)</span></td>
<td style="text-align: left;"><span class="math inline">\(c\)</span></td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SGD</td>
<td style="text-align: left;"><span class="math inline">\(R\)</span></td>
<td style="text-align: left;">0.</td>
<td style="text-align: left;">0.</td>
<td style="text-align: left;">0.</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
</tr>
</tbody>
</table>
</div>
<p><code>spotPython</code> implements an <code>optimization</code> handler that maps the optimizer names to the corresponding <code>PyTorch</code> optimizers.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
A note on LBFGS
</div>
</div>
<div class="callout-body-container callout-body">
<p>We recommend deactivating <code>PyTorch</code>’s LBFGS optimizer, because it does not perform very well. The <code>PyTorch</code> documentation, see <a href="https://pytorch.org/docs/stable/generated/torch.optim.LBFGS.html#torch.optim.LBFGS">https://pytorch.org/docs/stable/generated/torch.optim.LBFGS.html#torch.optim.LBFGS</a>, states:</p>
<blockquote class="blockquote">
<p>This is a very memory intensive optimizer (it requires additional <code>param_bytes * (history_size + 1)</code> bytes). If it doesn’t fit in memory try reducing the history size, or use a different algorithm.</p>
</blockquote>
<p>Furthermore, the LBFGS optimizer is not compatible with the <code>PyTorch</code> tutorial. The reason is that the LBFGS optimizer requires the <code>closure</code> function, which is not implemented in the <code>PyTorch</code> tutorial. Therefore, the <code>LBFGS</code> optimizer is recommended here. Since there are ten optimizers in the portfolio, it is not recommended tuning the hyperparameters that effect one single optimizer only.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
A note on the learning rate
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>spotPython</code> provides a multiplier for the default learning rates, <code>lr_mult</code>, because optimizers use different learning rates. Using a multiplier for the learning rates might enable a simultaneous tuning of the learning rates for all optimizers. However, this is not recommended, because the learning rates are not comparable across optimizers. Therefore, we recommend fixing the learning rate for all optimizers if multiple optimizers are used. This can be done by setting the lower and upper bounds of the learning rate multiplier to the same value as shown below.</p>
<p>Thus, the learning rate, which affects the <code>SGD</code> optimizer, will be set to a fixed value. We choose the default value of <code>1e-3</code> for the learning rate, because it is used in other <code>PyTorch</code> examples (it is also the default value used by <code>spotPython</code> as defined in the <code>optimizer_handler()</code> method). We recommend tuning the learning rate later, when a reduced set of optimizers is fixed. Here, we will demonstrate how to select in a screening phase the optimizers that should be used for the hyperparameter tuning.</p>
</div>
</div>
<p>For the same reason, we will fix the <code>sgd_momentum</code> to <code>0.9</code>.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>fun_control <span class="op">=</span> modify_hyper_parameter_bounds(fun_control,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lr_mult"</span>, bounds<span class="op">=</span>[<span class="fl">1.0</span>, <span class="fl">1.0</span>])</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>fun_control <span class="op">=</span> modify_hyper_parameter_bounds(fun_control,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sgd_momentum"</span>, bounds<span class="op">=</span>[<span class="fl">0.9</span>, <span class="fl">0.9</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-data-splitting-14" class="level2" data-number="13.7">
<h2 data-number="13.7" class="anchored" data-anchor-id="sec-data-splitting-14"><span class="header-section-number">13.7</span> Evaluation: Data Splitting</h2>
<p>The evaluation procedure requires the specification of the way how the data is split into a train and a test set and the loss function (and a metric). As a default, <code>spotPython</code> provides a standard hold-out data split and cross validation.</p>
<section id="hold-out-data-split" class="level3" data-number="13.7.1">
<h3 data-number="13.7.1" class="anchored" data-anchor-id="hold-out-data-split"><span class="header-section-number">13.7.1</span> Hold-out Data Split</h3>
<p>If a hold-out data split is used, the data will be partitioned into a training, a validation, and a test data set. The split depends on the setting of the <code>eval</code> parameter. If <code>eval</code> is set to <code>train_hold_out</code>, one data set, usually the original training data set, is split into a new training and a validation data set. The training data set is used for training the model. The validation data set is used for the evaluation of the hyperparameter configuration and early stopping to prevent overfitting. In this case, the original test data set is not used.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>spotPython</code> returns the hyperparameters of the machine learning and deep learning models, e.g., number of layers, learning rate, or optimizer, but not the model weights. Therefore, after the SPOT run is finished, the corresponding model with the optimized architecture has to be trained again with the best hyperparameter configuration. The training is performed on the training data set. The test data set is used for the final evaluation of the model.</p>
<p>Summarizing, the following splits are performed in the hold-out setting:</p>
<ol type="1">
<li>Run <code>spotPython</code> with <code>eval</code> set to <code>train_hold_out</code> to determine the best hyperparameter configuration.</li>
<li>Train the model with the best hyperparameter configuration (“architecture”) on the training data set: <code>train_tuned(model_spot, train, "model_spot.pt")</code>.</li>
<li>Test the model on the test data: <code>test_tuned(model_spot, test, "model_spot.pt")</code></li>
</ol>
<p>These steps will be exemplified in the following sections.</p>
</div>
</div>
<p>In addition to this <code>hold-out</code> setting, <code>spotPython</code> provides another hold-out setting, where an explicit test data is specified by the user that will be used as the validation set. To choose this option, the <code>eval</code> parameter is set to <code>test_hold_out</code>. In this case, the training data set is used for the model training. Then, the explicitly defined test data set is used for the evaluation of the hyperparameter configuration (the validation).</p>
</section>
<section id="cross-validation" class="level3" data-number="13.7.2">
<h3 data-number="13.7.2" class="anchored" data-anchor-id="cross-validation"><span class="header-section-number">13.7.2</span> Cross-Validation</h3>
<p>The cross validation setting is used by setting the <code>eval</code> parameter to <code>train_cv</code> or <code>test_cv</code>. In both cases, the data set is split into <span class="math inline">\(k\)</span> folds. The model is trained on <span class="math inline">\(k-1\)</span> folds and evaluated on the remaining fold. This is repeated <span class="math inline">\(k\)</span> times, so that each fold is used exactly once for evaluation. The final evaluation is performed on the test data set. The cross validation setting is useful for small data sets, because it allows to use all data for training and evaluation. However, it is computationally expensive, because the model has to be trained <span class="math inline">\(k\)</span> times.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Combinations of the above settings are possible, e.g., cross validation can be used for training and hold-out for evaluation or <em>vice versa</em>. Also, cross validation can be used for training and testing. Because cross validation is not used in the <code>PyTorch</code> tutorial <span class="citation" data-cites="pyto23a">(<a href="references.html#ref-pyto23a" role="doc-biblioref">PyTorch 2023a</a>)</span>, it is not considered further here.</p>
</div>
</div>
</section>
<section id="overview-of-the-evaluation-settings" class="level3" data-number="13.7.3">
<h3 data-number="13.7.3" class="anchored" data-anchor-id="overview-of-the-evaluation-settings"><span class="header-section-number">13.7.3</span> Overview of the Evaluation Settings</h3>
<section id="settings-for-the-hyperparameter-tuning" class="level4" data-number="13.7.3.1">
<h4 data-number="13.7.3.1" class="anchored" data-anchor-id="settings-for-the-hyperparameter-tuning"><span class="header-section-number">13.7.3.1</span> Settings for the Hyperparameter Tuning</h4>
<p>An overview of the training evaluations is shown in <a href="#tbl-eval-settings">Table&nbsp;<span>13.2</span></a>. <code>"train_cv"</code> and <code>"test_cv"</code> use <code>sklearn.model_selection.KFold()</code> internally. More details on the data splitting are provided in <a href="99_spot_doc.html#sec-detailed-data-splitting"><span>Section&nbsp;20.14</span></a> (in the Appendix).</p>
<div id="tbl-eval-settings" class="anchored">
<table class="table">
<caption>Table&nbsp;13.2: Overview of the evaluation settings.</caption>
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 28%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th><code>eval</code></th>
<th style="text-align: center;"><code>train</code></th>
<th style="text-align: center;"><code>test</code></th>
<th style="text-align: left;">function</th>
<th style="text-align: left;">comment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>"train_hold_out"</code></td>
<td style="text-align: center;"><span class="math inline">\(\checkmark\)</span></td>
<td style="text-align: center;"></td>
<td style="text-align: left;"><code>train_one_epoch()</code>, <code>validate_one_epoch()</code> for early stopping</td>
<td style="text-align: left;">splits the <code>train</code> data set internally</td>
</tr>
<tr class="even">
<td><code>"test_hold_out"</code></td>
<td style="text-align: center;"><span class="math inline">\(\checkmark\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\checkmark\)</span></td>
<td style="text-align: left;"><code>train_one_epoch()</code>, <code>validate_one_epoch()</code> for early stopping</td>
<td style="text-align: left;">use the <code>test data set</code> for <code>validate_one_epoch()</code></td>
</tr>
<tr class="odd">
<td><code>"train_cv"</code></td>
<td style="text-align: center;"><span class="math inline">\(\checkmark\)</span></td>
<td style="text-align: center;"></td>
<td style="text-align: left;"><code>evaluate_cv(net, train)</code></td>
<td style="text-align: left;">CV using the <code>train</code> data set</td>
</tr>
<tr class="even">
<td><code>"test_cv"</code></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><span class="math inline">\(\checkmark\)</span></td>
<td style="text-align: left;"><code>evaluate_cv(net, test)</code></td>
<td style="text-align: left;">CV using the <code>test</code> data set . Identical to <code>"train_cv"</code>, uses only test data.</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="settings-for-the-final-evaluation-of-the-tuned-architecture" class="level4" data-number="13.7.3.2">
<h4 data-number="13.7.3.2" class="anchored" data-anchor-id="settings-for-the-final-evaluation-of-the-tuned-architecture"><span class="header-section-number">13.7.3.2</span> Settings for the Final Evaluation of the Tuned Architecture</h4>
<section id="training-of-the-tuned-architecture" class="level5" data-number="13.7.3.2.1">
<h5 data-number="13.7.3.2.1" class="anchored" data-anchor-id="training-of-the-tuned-architecture"><span class="header-section-number">13.7.3.2.1</span> Training of the Tuned Architecture</h5>
<p><code>train_tuned(model, train)</code>: train the model with the best hyperparameter configuration (or simply the default) on the training data set. It splits the <code>train</code>data into new <code>train</code> and <code>validation</code> sets using <code>create_train_val_data_loaders()</code>, which calls <code>torch.utils.data.random_split()</code> internally. Currently, 60% of the data is used for training and 40% for validation. The <code>train</code> data is used for training the model with <code>train_hold_out()</code>. The <code>validation</code> data is used for early stopping using <code>validate_fold_or_hold_out()</code> on the <code>validation</code> data set.</p>
</section>
<section id="testing-of-the-tuned-architecture" class="level5" data-number="13.7.3.2.2">
<h5 data-number="13.7.3.2.2" class="anchored" data-anchor-id="testing-of-the-tuned-architecture"><span class="header-section-number">13.7.3.2.2</span> Testing of the Tuned Architecture</h5>
<p><code>test_tuned(model, test)</code>: test the model on the test data set. No data splitting is performed. The (trained) model is evaluated using the <code>validate_fold_or_hold_out()</code> function. Note: During training, <code>"shuffle"</code> is set to <code>True</code>, whereas during testing, <code>"shuffle"</code> is set to <code>False</code>.</p>
<p><a href="99_spot_doc.html#sec-final-model-evaluation"><span>Section&nbsp;20.14.1.4</span></a> describes the final evaluation of the tuned architecture.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fun_control.update({</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"eval"</span>: <span class="st">"train_hold_out"</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"path"</span>: <span class="st">"torch_model.pt"</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"shuffle"</span>: <span class="va">True</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
</section>
<section id="sec-loss-functions-14" class="level2" data-number="13.8">
<h2 data-number="13.8" class="anchored" data-anchor-id="sec-loss-functions-14"><span class="header-section-number">13.8</span> Evaluation: Loss Functions and Metrics</h2>
<p>The key <code>"loss_function"</code> specifies the loss function which is used during the optimization. There are several different loss functions under <code>PyTorch</code>’s <code>nn</code> package. For example, a simple loss is <code>MSELoss</code>, which computes the mean-squared error between the output and the target. In this tutorial we will use <code>CrossEntropyLoss</code>, because it is also used in the <code>PyTorch</code> tutorial.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch.nn <span class="im">import</span> CrossEntropyLoss</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>loss_function <span class="op">=</span> CrossEntropyLoss()</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>fun_control.update({<span class="st">"loss_function"</span>: loss_function})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In addition to the loss functions, <code>spotPython</code> provides access to a large number of metrics.</p>
<ul>
<li>The key <code>"metric_sklearn"</code> is used for metrics that follow the <code>scikit-learn</code> conventions.</li>
<li>The key <code>"river_metric"</code> is used for the river based evaluation <span class="citation" data-cites="mont20a">(<a href="references.html#ref-mont20a" role="doc-biblioref">Montiel et al. 2021</a>)</span> via <code>eval_oml_iter_progressive</code>, and</li>
<li>the key <code>"metric_torch"</code> is used for the metrics from <code>TorchMetrics</code>.</li>
</ul>
<p><code>TorchMetrics</code> is a collection of more than 90 PyTorch metrics, see <a href="https://torchmetrics.readthedocs.io/en/latest/">https://torchmetrics.readthedocs.io/en/latest/</a>. Because the <code>PyTorch</code> tutorial uses the accuracy as metric, we use the same metric here. Currently, accuracy is computed in the tutorial’s example code. We will use <code>TorchMetrics</code> instead, because it offers more flexibilty, e.g., it can be used for regression and classification. Furthermore, <code>TorchMetrics</code> offers the following advantages:</p>
<pre><code>* A standardized interface to increase reproducibility
* Reduces Boilerplate
* Distributed-training compatible
* Rigorously tested
* Automatic accumulation over batches
* Automatic synchronization between multiple devices</code></pre>
<p>Therefore, we set</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torchmetrics</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>metric_torch <span class="op">=</span> torchmetrics.Accuracy(task<span class="op">=</span><span class="st">"multiclass"</span>, num_classes<span class="op">=</span><span class="dv">10</span>).to(fun_control[<span class="st">"device"</span>])</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>fun_control.update({<span class="st">"metric_torch"</span>: metric_torch})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-prepare-spot-call-14" class="level2" data-number="13.9">
<h2 data-number="13.9" class="anchored" data-anchor-id="sec-prepare-spot-call-14"><span class="header-section-number">13.9</span> Preparing the SPOT Call</h2>
<p>The following code passes the information about the parameter ranges and bounds to <code>spot</code>.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotPython.hyperparameters.values <span class="im">import</span> (</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    get_var_type,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    get_var_name,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    get_bound_values    </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>var_type <span class="op">=</span> get_var_type(fun_control)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>var_name <span class="op">=</span> get_var_name(fun_control)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>fun_control.update({<span class="st">"var_type"</span>: var_type,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"var_name"</span>: var_name})</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>lower <span class="op">=</span> get_bound_values(fun_control, <span class="st">"lower"</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>upper <span class="op">=</span> get_bound_values(fun_control, <span class="st">"upper"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, the dictionary <code>fun_control</code> contains all information needed for the hyperparameter tuning. Before the hyperparameter tuning is started, it is recommended to take a look at the experimental design. The method <code>gen_design_table</code> generates a design table as follows:</p>
<div class="cell" data-fig-label="tbl-design" data-execution_count="19">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotPython.utils.eda <span class="im">import</span> gen_design_table</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gen_design_table(fun_control))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>| name         | type   | default   |   lower |   upper | transform             |
|--------------|--------|-----------|---------|---------|-----------------------|
| l1           | int    | 5         |     2   |     9   | transform_power_2_int |
| l2           | int    | 5         |     2   |     9   | transform_power_2_int |
| lr_mult      | float  | 1.0       |     1   |     1   | None                  |
| batch_size   | int    | 4         |     1   |     5   | transform_power_2_int |
| epochs       | int    | 3         |     3   |     4   | transform_power_2_int |
| k_folds      | int    | 1         |     0   |     0   | None                  |
| patience     | int    | 5         |     3   |     3   | None                  |
| optimizer    | factor | SGD       |     0   |     9   | None                  |
| sgd_momentum | float  | 0.0       |     0.9 |     0.9 | None                  |</code></pre>
</div>
</div>
<p>This allows to check if all information is available and if the information is correct. <span class="quarto-unresolved-ref">?tbl-design</span> shows the experimental design for the hyperparameter tuning. The table shows the hyperparameters, their types, default values, lower and upper bounds, and the transformation function. The transformation function is used to transform the hyperparameter values from the unit hypercube to the original domain. The transformation function is applied to the hyperparameter values before the evaluation of the objective function. Hyperparameter transformations are shown in the column “transform”, e.g., the <code>l1</code> default is <code>5</code>, which results in the value <span class="math inline">\(2^5 = 32\)</span> for the network, because the transformation <code>transform_power_2_int</code> was selected in the <code>JSON</code> file. The default value of the <code>batch_size</code> is set to <code>4</code>, which results in a batch size of <span class="math inline">\(2^4 = 16\)</span>.</p>
</section>
<section id="sec-the-objective-function-14" class="level2" data-number="13.10">
<h2 data-number="13.10" class="anchored" data-anchor-id="sec-the-objective-function-14"><span class="header-section-number">13.10</span> The Objective Function <code>fun_torch</code></h2>
<p>The objective function <code>fun_torch</code> is selected next. It implements an interface from <code>PyTorch</code>’s training, validation, and testing methods to <code>spotPython</code>.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotPython.fun.hypertorch <span class="im">import</span> HyperTorch</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>fun <span class="op">=</span> HyperTorch().fun_torch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-default-hyperparameters" class="level2" data-number="13.11">
<h2 data-number="13.11" class="anchored" data-anchor-id="sec-default-hyperparameters"><span class="header-section-number">13.11</span> Using Default Hyperparameters or Results from Previous Runs</h2>
<p>We add the default setting to the initial design:</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotPython.hyperparameters.values <span class="im">import</span> get_default_hyperparameters_as_array</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>hyper_dict<span class="op">=</span>TorchHyperDict().load()</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>X_start <span class="op">=</span> get_default_hyperparameters_as_array(fun_control, hyper_dict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-call-the-hyperparameter-tuner-14" class="level2" data-number="13.12">
<h2 data-number="13.12" class="anchored" data-anchor-id="sec-call-the-hyperparameter-tuner-14"><span class="header-section-number">13.12</span> Starting the Hyperparameter Tuning</h2>
<p>The <code>spotPython</code> hyperparameter tuning is started by calling the <code>Spot</code> function. Here, we will run the tuner for approximately 30 minutes (<code>max_time</code>). Note: the initial design is always evaluated in the <code>spotPython</code> run. As a consequence, the run may take longer than specified by <code>max_time</code>, because the evaluation time of initial design (here: <code>init_size</code>, 10 points) is performed independently of <code>max_time</code>. During the run, results from the training is shown. These results can be visualized with Tensorboard as will be shown in <a href="#sec-tensorboard-14"><span>Section&nbsp;13.13</span></a>.</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotPython.spot <span class="im">import</span> spot</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> inf</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>spot_tuner <span class="op">=</span> spot.Spot(fun<span class="op">=</span>fun,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                   lower <span class="op">=</span> lower,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>                   upper <span class="op">=</span> upper,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>                   fun_evals <span class="op">=</span> inf,</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>                   fun_repeats <span class="op">=</span> <span class="dv">1</span>,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>                   max_time <span class="op">=</span> MAX_TIME,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>                   noise <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>                   tolerance_x <span class="op">=</span> np.sqrt(np.spacing(<span class="dv">1</span>)),</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>                   var_type <span class="op">=</span> var_type,</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>                   var_name <span class="op">=</span> var_name,</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>                   infill_criterion <span class="op">=</span> <span class="st">"y"</span>,</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>                   n_points <span class="op">=</span> <span class="dv">1</span>,</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>                   seed<span class="op">=</span><span class="dv">123</span>,</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>                   log_level <span class="op">=</span> <span class="dv">50</span>,</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>                   show_models<span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>                   show_progress<span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>                   fun_control <span class="op">=</span> fun_control,</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>                   design_control<span class="op">=</span>{<span class="st">"init_size"</span>: INIT_SIZE,</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"repeats"</span>: <span class="dv">1</span>},</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>                   surrogate_control<span class="op">=</span>{<span class="st">"noise"</span>: <span class="va">True</span>,</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"cod_type"</span>: <span class="st">"norm"</span>,</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"min_theta"</span>: <span class="op">-</span><span class="dv">4</span>,</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"max_theta"</span>: <span class="dv">3</span>,</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"n_theta"</span>: <span class="bu">len</span>(var_name),</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"model_fun_evals"</span>: <span class="dv">10_000</span>,</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"log_level"</span>: <span class="dv">50</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>                                      })</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>spot_tuner.run(X_start<span class="op">=</span>X_start)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
config: {'l1': 64, 'l2': 16, 'lr_mult': 1.0, 'batch_size': 16, 'epochs': 16, 'k_folds': 0, 'patience': 3, 'optimizer': 'NAdam', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.4531873696327209
Accuracy on hold-out set: 0.465
MulticlassAccuracy value on hold-out data: 0.4650000035762787
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.325196225118637
Accuracy on hold-out set: 0.525
MulticlassAccuracy value on hold-out data: 0.5249999761581421
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3048064527988434
Accuracy on hold-out set: 0.53355
MulticlassAccuracy value on hold-out data: 0.5335500240325928
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2734438054800035
Accuracy on hold-out set: 0.55855
MulticlassAccuracy value on hold-out data: 0.5585500001907349
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2120844751596451
Accuracy on hold-out set: 0.5749
MulticlassAccuracy value on hold-out data: 0.5748999714851379
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2068462555170059
Accuracy on hold-out set: 0.5833
MulticlassAccuracy value on hold-out data: 0.583299994468689
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1836825958490371
Accuracy on hold-out set: 0.58985
MulticlassAccuracy value on hold-out data: 0.5898500084877014
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1850792266607284
Accuracy on hold-out set: 0.59325
MulticlassAccuracy value on hold-out data: 0.5932499766349792
Epoch: 9</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.166281735277176
Accuracy on hold-out set: 0.60015
MulticlassAccuracy value on hold-out data: 0.6001499891281128
Epoch: 10</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1835454508304597
Accuracy on hold-out set: 0.5997
MulticlassAccuracy value on hold-out data: 0.5996999740600586
Epoch: 11</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2132742559909822
Accuracy on hold-out set: 0.5947
MulticlassAccuracy value on hold-out data: 0.5946999788284302
Epoch: 12</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2120959482431413
Accuracy on hold-out set: 0.5944
MulticlassAccuracy value on hold-out data: 0.5943999886512756
Early stopping at epoch 11
Returned to Spot: Validation loss: 1.2120959482431413
----------------------------------------------

config: {'l1': 16, 'l2': 128, 'lr_mult': 1.0, 'batch_size': 4, 'epochs': 16, 'k_folds': 0, 'patience': 3, 'optimizer': 'NAdam', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.5005870576888323
Accuracy on hold-out set: 0.4507
MulticlassAccuracy value on hold-out data: 0.4507000148296356
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.4895953057467937
Accuracy on hold-out set: 0.46875
MulticlassAccuracy value on hold-out data: 0.46875
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.5067340997964145
Accuracy on hold-out set: 0.4771
MulticlassAccuracy value on hold-out data: 0.4771000146865845
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.420065576042235
Accuracy on hold-out set: 0.5134
MulticlassAccuracy value on hold-out data: 0.5134000182151794
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3807816077925266
Accuracy on hold-out set: 0.5275
MulticlassAccuracy value on hold-out data: 0.5274999737739563
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3997260218821466
Accuracy on hold-out set: 0.53845
MulticlassAccuracy value on hold-out data: 0.5384500026702881
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.358016163313389
Accuracy on hold-out set: 0.544
MulticlassAccuracy value on hold-out data: 0.5440000295639038
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.4457263150051236
Accuracy on hold-out set: 0.5355
MulticlassAccuracy value on hold-out data: 0.5354999899864197
Epoch: 9</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.4476015083182603
Accuracy on hold-out set: 0.53715
MulticlassAccuracy value on hold-out data: 0.5371500253677368
Epoch: 10</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3770421450687573
Accuracy on hold-out set: 0.54405
MulticlassAccuracy value on hold-out data: 0.5440499782562256
Early stopping at epoch 9
Returned to Spot: Validation loss: 1.3770421450687573
----------------------------------------------

config: {'l1': 32, 'l2': 8, 'lr_mult': 1.0, 'batch_size': 8, 'epochs': 8, 'k_folds': 0, 'patience': 3, 'optimizer': 'ASGD', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.0151158308029173
Accuracy on hold-out set: 0.2361
MulticlassAccuracy value on hold-out data: 0.2361000031232834
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.8380549493789673
Accuracy on hold-out set: 0.29645
MulticlassAccuracy value on hold-out data: 0.2964499890804291
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.7380830037593842
Accuracy on hold-out set: 0.34725
MulticlassAccuracy value on hold-out data: 0.3472500145435333
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.6875056188583375
Accuracy on hold-out set: 0.3618
MulticlassAccuracy value on hold-out data: 0.3617999851703644
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.6507797204971313
Accuracy on hold-out set: 0.3751
MulticlassAccuracy value on hold-out data: 0.3750999867916107
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.6054888113737107
Accuracy on hold-out set: 0.38645
MulticlassAccuracy value on hold-out data: 0.38644999265670776
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.5978620321035386
Accuracy on hold-out set: 0.3944
MulticlassAccuracy value on hold-out data: 0.3944000005722046
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.5594049923419953
Accuracy on hold-out set: 0.41145
MulticlassAccuracy value on hold-out data: 0.41144999861717224
Returned to Spot: Validation loss: 1.5594049923419953
----------------------------------------------

config: {'l1': 8, 'l2': 64, 'lr_mult': 1.0, 'batch_size': 4, 'epochs': 8, 'k_folds': 0, 'patience': 3, 'optimizer': 'Adamax', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.5543288917303086
Accuracy on hold-out set: 0.42405
MulticlassAccuracy value on hold-out data: 0.4240500032901764
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.4726357238292693
Accuracy on hold-out set: 0.4561
MulticlassAccuracy value on hold-out data: 0.4560999870300293
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.4089747812896967
Accuracy on hold-out set: 0.48535
MulticlassAccuracy value on hold-out data: 0.48535001277923584
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3494931949332356
Accuracy on hold-out set: 0.51255
MulticlassAccuracy value on hold-out data: 0.5125499963760376
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3851889771848918
Accuracy on hold-out set: 0.50685
MulticlassAccuracy value on hold-out data: 0.506850004196167
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.323475112516433
Accuracy on hold-out set: 0.5249
MulticlassAccuracy value on hold-out data: 0.5249000191688538
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3506805676035583
Accuracy on hold-out set: 0.5229
MulticlassAccuracy value on hold-out data: 0.5228999853134155
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3404605934880673
Accuracy on hold-out set: 0.5318
MulticlassAccuracy value on hold-out data: 0.5317999720573425
Returned to Spot: Validation loss: 1.3404605934880673
----------------------------------------------

config: {'l1': 128, 'l2': 32, 'lr_mult': 1.0, 'batch_size': 8, 'epochs': 16, 'k_folds': 0, 'patience': 3, 'optimizer': 'AdamW', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.4604634573936461
Accuracy on hold-out set: 0.46545
MulticlassAccuracy value on hold-out data: 0.4654499888420105
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3089509534597397
Accuracy on hold-out set: 0.5315
MulticlassAccuracy value on hold-out data: 0.531499981880188
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2708063730597496
Accuracy on hold-out set: 0.5548
MulticlassAccuracy value on hold-out data: 0.5547999739646912
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2297203123867513
Accuracy on hold-out set: 0.57435
MulticlassAccuracy value on hold-out data: 0.5743499994277954
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1867765383303166
Accuracy on hold-out set: 0.58975
MulticlassAccuracy value on hold-out data: 0.5897499918937683
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2137519815444946
Accuracy on hold-out set: 0.58415
MulticlassAccuracy value on hold-out data: 0.5841500163078308
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.24783908636868
Accuracy on hold-out set: 0.57795
MulticlassAccuracy value on hold-out data: 0.5779500007629395
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2409861245393754
Accuracy on hold-out set: 0.5781
MulticlassAccuracy value on hold-out data: 0.5781000256538391
Early stopping at epoch 7
Returned to Spot: Validation loss: 1.2409861245393754
----------------------------------------------

config: {'l1': 512, 'l2': 16, 'lr_mult': 1.0, 'batch_size': 4, 'epochs': 16, 'k_folds': 0, 'patience': 3, 'optimizer': 'RMSprop', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.304224283838272
Accuracy on hold-out set: 0.10365
MulticlassAccuracy value on hold-out data: 0.10365000367164612
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.3086710446357728
Accuracy on hold-out set: 0.0982
MulticlassAccuracy value on hold-out data: 0.0982000008225441
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.3041055164337156
Accuracy on hold-out set: 0.09975
MulticlassAccuracy value on hold-out data: 0.09974999725818634
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.3042114679813386
Accuracy on hold-out set: 0.10005
MulticlassAccuracy value on hold-out data: 0.10005000233650208
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.3042567992210388
Accuracy on hold-out set: 0.10005
MulticlassAccuracy value on hold-out data: 0.10005000233650208
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.305777049589157
Accuracy on hold-out set: 0.10005
MulticlassAccuracy value on hold-out data: 0.10005000233650208
Early stopping at epoch 5
Returned to Spot: Validation loss: 2.305777049589157
----------------------------------------------

config: {'l1': 8, 'l2': 8, 'lr_mult': 1.0, 'batch_size': 16, 'epochs': 8, 'k_folds': 0, 'patience': 3, 'optimizer': 'Adagrad', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.8623228480339051
Accuracy on hold-out set: 0.285
MulticlassAccuracy value on hold-out data: 0.2849999964237213
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.7958615369796753
Accuracy on hold-out set: 0.3275
MulticlassAccuracy value on hold-out data: 0.32749998569488525
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.7516172283172606
Accuracy on hold-out set: 0.3393
MulticlassAccuracy value on hold-out data: 0.3393000066280365
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.7269452848434448
Accuracy on hold-out set: 0.34945
MulticlassAccuracy value on hold-out data: 0.3494499921798706
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.7147653727531433
Accuracy on hold-out set: 0.3551
MulticlassAccuracy value on hold-out data: 0.35510000586509705
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.6960768105506896
Accuracy on hold-out set: 0.36215
MulticlassAccuracy value on hold-out data: 0.36215001344680786
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.6849525526046754
Accuracy on hold-out set: 0.3691
MulticlassAccuracy value on hold-out data: 0.36910000443458557
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.6722080268859862
Accuracy on hold-out set: 0.3775
MulticlassAccuracy value on hold-out data: 0.3774999976158142
Returned to Spot: Validation loss: 1.6722080268859862
----------------------------------------------

config: {'l1': 256, 'l2': 64, 'lr_mult': 1.0, 'batch_size': 16, 'epochs': 8, 'k_folds': 0, 'patience': 3, 'optimizer': 'RMSprop', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.033727491092682
Accuracy on hold-out set: 0.23535
MulticlassAccuracy value on hold-out data: 0.23534999787807465
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.9742233956336974
Accuracy on hold-out set: 0.25375
MulticlassAccuracy value on hold-out data: 0.2537499964237213
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.0164827750205996
Accuracy on hold-out set: 0.247
MulticlassAccuracy value on hold-out data: 0.24699999392032623
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.9548802864074708
Accuracy on hold-out set: 0.26835
MulticlassAccuracy value on hold-out data: 0.2683500051498413
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.9147050152778626
Accuracy on hold-out set: 0.27635
MulticlassAccuracy value on hold-out data: 0.2763499915599823
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.880613294696808
Accuracy on hold-out set: 0.27755
MulticlassAccuracy value on hold-out data: 0.27755001187324524
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.8822319697380065
Accuracy on hold-out set: 0.28125
MulticlassAccuracy value on hold-out data: 0.28125
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.9520383694648742
Accuracy on hold-out set: 0.28685
MulticlassAccuracy value on hold-out data: 0.2868500053882599
Returned to Spot: Validation loss: 1.9520383694648742
----------------------------------------------

config: {'l1': 256, 'l2': 512, 'lr_mult': 1.0, 'batch_size': 2, 'epochs': 8, 'k_folds': 0, 'patience': 3, 'optimizer': 'AdamW', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.714820458814455
Accuracy on hold-out set: 0.4314
MulticlassAccuracy value on hold-out data: 0.43140000104904175
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.6406829629886859
Accuracy on hold-out set: 0.47825
MulticlassAccuracy value on hold-out data: 0.47824999690055847
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.545428125515567
Accuracy on hold-out set: 0.4975
MulticlassAccuracy value on hold-out data: 0.4975000023841858
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.5244613147333956
Accuracy on hold-out set: 0.51565
MulticlassAccuracy value on hold-out data: 0.5156499743461609
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.6418606465695462
Accuracy on hold-out set: 0.52855
MulticlassAccuracy value on hold-out data: 0.5285500288009644
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.6219294878519634
Accuracy on hold-out set: 0.5234
MulticlassAccuracy value on hold-out data: 0.5234000086784363
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.5469318324963246
Accuracy on hold-out set: 0.53335
MulticlassAccuracy value on hold-out data: 0.5333499908447266
Early stopping at epoch 6
Returned to Spot: Validation loss: 1.5469318324963246
----------------------------------------------

config: {'l1': 4, 'l2': 256, 'lr_mult': 1.0, 'batch_size': 32, 'epochs': 16, 'k_folds': 0, 'patience': 3, 'optimizer': 'Adadelta', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.6368618047714234
Accuracy on hold-out set: 0.3795
MulticlassAccuracy value on hold-out data: 0.37950000166893005
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.4890002604484558
Accuracy on hold-out set: 0.44565
MulticlassAccuracy value on hold-out data: 0.44565001130104065
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.4198544501304626
Accuracy on hold-out set: 0.4787
MulticlassAccuracy value on hold-out data: 0.47870001196861267
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3945291288375854
Accuracy on hold-out set: 0.47445
MulticlassAccuracy value on hold-out data: 0.4744499921798706
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3828875508308411
Accuracy on hold-out set: 0.48545
MulticlassAccuracy value on hold-out data: 0.48544999957084656
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3790054025650025
Accuracy on hold-out set: 0.4917
MulticlassAccuracy value on hold-out data: 0.4916999936103821
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.34652443151474
Accuracy on hold-out set: 0.5028
MulticlassAccuracy value on hold-out data: 0.5027999877929688
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.4034742686271668
Accuracy on hold-out set: 0.48495
MulticlassAccuracy value on hold-out data: 0.4849500060081482
Epoch: 9</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.342092141532898
Accuracy on hold-out set: 0.50445
MulticlassAccuracy value on hold-out data: 0.5044500231742859
Epoch: 10</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.4018613757133485
Accuracy on hold-out set: 0.4942
MulticlassAccuracy value on hold-out data: 0.4941999912261963
Epoch: 11</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3043518905639648
Accuracy on hold-out set: 0.52165
MulticlassAccuracy value on hold-out data: 0.5216500163078308
Epoch: 12</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3959884852409363
Accuracy on hold-out set: 0.50015
MulticlassAccuracy value on hold-out data: 0.5001500248908997
Epoch: 13</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3304384766578674
Accuracy on hold-out set: 0.52045
MulticlassAccuracy value on hold-out data: 0.5204499959945679
Epoch: 14</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3407153537750245
Accuracy on hold-out set: 0.5124
MulticlassAccuracy value on hold-out data: 0.5123999714851379
Early stopping at epoch 13
Returned to Spot: Validation loss: 1.3407153537750245
----------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
config: {'l1': 64, 'l2': 32, 'lr_mult': 1.0, 'batch_size': 16, 'epochs': 16, 'k_folds': 0, 'patience': 3, 'optimizer': 'AdamW', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.5650458437919617
Accuracy on hold-out set: 0.41825
MulticlassAccuracy value on hold-out data: 0.4182499945163727
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.445731195640564
Accuracy on hold-out set: 0.4699
MulticlassAccuracy value on hold-out data: 0.4699000120162964
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3417516043663025
Accuracy on hold-out set: 0.52355
MulticlassAccuracy value on hold-out data: 0.5235499739646912
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.262966798520088
Accuracy on hold-out set: 0.55425
MulticlassAccuracy value on hold-out data: 0.5542500019073486
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2543963306427002
Accuracy on hold-out set: 0.5588
MulticlassAccuracy value on hold-out data: 0.5587999820709229
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2052456276416779
Accuracy on hold-out set: 0.57825
MulticlassAccuracy value on hold-out data: 0.578249990940094
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.225034781074524
Accuracy on hold-out set: 0.5767
MulticlassAccuracy value on hold-out data: 0.57669997215271
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1629827931880952
Accuracy on hold-out set: 0.5963
MulticlassAccuracy value on hold-out data: 0.5963000059127808
Epoch: 9</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1475618918180466
Accuracy on hold-out set: 0.6036
MulticlassAccuracy value on hold-out data: 0.603600025177002
Epoch: 10</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1584332782506943
Accuracy on hold-out set: 0.60115
MulticlassAccuracy value on hold-out data: 0.6011499762535095
Epoch: 11</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1803555101156236
Accuracy on hold-out set: 0.59495
MulticlassAccuracy value on hold-out data: 0.5949500203132629
Epoch: 12</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.19343827252388
Accuracy on hold-out set: 0.5925
MulticlassAccuracy value on hold-out data: 0.5924999713897705
Early stopping at epoch 11
Returned to Spot: Validation loss: 1.19343827252388
----------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>spotPython tuning: 1.19343827252388 [#---------] 8.48% </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
config: {'l1': 64, 'l2': 16, 'lr_mult': 1.0, 'batch_size': 16, 'epochs': 16, 'k_folds': 0, 'patience': 3, 'optimizer': 'AdamW', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.5412216246128083
Accuracy on hold-out set: 0.4335
MulticlassAccuracy value on hold-out data: 0.4334999918937683
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.4014608226299285
Accuracy on hold-out set: 0.4952
MulticlassAccuracy value on hold-out data: 0.4952000081539154
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3415150342941284
Accuracy on hold-out set: 0.5222
MulticlassAccuracy value on hold-out data: 0.5221999883651733
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2791368619918824
Accuracy on hold-out set: 0.5424
MulticlassAccuracy value on hold-out data: 0.5424000024795532
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2638525828123093
Accuracy on hold-out set: 0.557
MulticlassAccuracy value on hold-out data: 0.5569999814033508
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2445933714866637
Accuracy on hold-out set: 0.5644
MulticlassAccuracy value on hold-out data: 0.5644000172615051
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1995793781757356
Accuracy on hold-out set: 0.57665
MulticlassAccuracy value on hold-out data: 0.5766500234603882
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1943189901113511
Accuracy on hold-out set: 0.58475
MulticlassAccuracy value on hold-out data: 0.5847499966621399
Epoch: 9</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1913710834741593
Accuracy on hold-out set: 0.5865
MulticlassAccuracy value on hold-out data: 0.5864999890327454
Epoch: 10</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1839374267339706
Accuracy on hold-out set: 0.5901
MulticlassAccuracy value on hold-out data: 0.5900999903678894
Epoch: 11</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1812278437137604
Accuracy on hold-out set: 0.5866
MulticlassAccuracy value on hold-out data: 0.5866000056266785
Epoch: 12</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2444978132724762
Accuracy on hold-out set: 0.58325
MulticlassAccuracy value on hold-out data: 0.5832499861717224
Epoch: 13</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1696878748416901
Accuracy on hold-out set: 0.59405
MulticlassAccuracy value on hold-out data: 0.5940499901771545
Epoch: 14</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2090726840496062
Accuracy on hold-out set: 0.5943
MulticlassAccuracy value on hold-out data: 0.5942999720573425
Epoch: 15</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2110995768785477
Accuracy on hold-out set: 0.59075
MulticlassAccuracy value on hold-out data: 0.590749979019165
Epoch: 16</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2590364922046662
Accuracy on hold-out set: 0.5813
MulticlassAccuracy value on hold-out data: 0.5813000202178955
Early stopping at epoch 15
Returned to Spot: Validation loss: 1.2590364922046662
----------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>spotPython tuning: 1.19343827252388 [##--------] 19.93% </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
config: {'l1': 64, 'l2': 64, 'lr_mult': 1.0, 'batch_size': 16, 'epochs': 16, 'k_folds': 0, 'patience': 3, 'optimizer': 'NAdam', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.4611024236679078
Accuracy on hold-out set: 0.46365
MulticlassAccuracy value on hold-out data: 0.4636499881744385
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3886946356773378
Accuracy on hold-out set: 0.5037
MulticlassAccuracy value on hold-out data: 0.5037000179290771
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2549228223323823
Accuracy on hold-out set: 0.56355
MulticlassAccuracy value on hold-out data: 0.5635499954223633
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2044146399497986
Accuracy on hold-out set: 0.57655
MulticlassAccuracy value on hold-out data: 0.5765500068664551
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2458909042119979
Accuracy on hold-out set: 0.56375
MulticlassAccuracy value on hold-out data: 0.5637500286102295
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2286671370744706
Accuracy on hold-out set: 0.57875
MulticlassAccuracy value on hold-out data: 0.5787500143051147
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2020091131210326
Accuracy on hold-out set: 0.5877
MulticlassAccuracy value on hold-out data: 0.5877000093460083
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2225105068445206
Accuracy on hold-out set: 0.5869
MulticlassAccuracy value on hold-out data: 0.586899995803833
Epoch: 9</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2825752641677857
Accuracy on hold-out set: 0.56875
MulticlassAccuracy value on hold-out data: 0.5687500238418579
Epoch: 10</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2709592715501785
Accuracy on hold-out set: 0.58095
MulticlassAccuracy value on hold-out data: 0.5809500217437744
Early stopping at epoch 9
Returned to Spot: Validation loss: 1.2709592715501785
----------------------------------------------
spotPython tuning: 1.19343827252388 [###-------] 27.16% </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
config: {'l1': 64, 'l2': 64, 'lr_mult': 1.0, 'batch_size': 16, 'epochs': 16, 'k_folds': 0, 'patience': 3, 'optimizer': 'AdamW', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.5346863508224486
Accuracy on hold-out set: 0.4341
MulticlassAccuracy value on hold-out data: 0.4341000020503998
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.4146504063606262
Accuracy on hold-out set: 0.49215
MulticlassAccuracy value on hold-out data: 0.4921500086784363
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3082896121263503
Accuracy on hold-out set: 0.533
MulticlassAccuracy value on hold-out data: 0.5329999923706055
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.210405622291565
Accuracy on hold-out set: 0.5708
MulticlassAccuracy value on hold-out data: 0.5708000063896179
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2332082440137864
Accuracy on hold-out set: 0.5648
MulticlassAccuracy value on hold-out data: 0.5648000240325928
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1999848236083985
Accuracy on hold-out set: 0.57735
MulticlassAccuracy value on hold-out data: 0.5773500204086304
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1633819435358048
Accuracy on hold-out set: 0.59525
MulticlassAccuracy value on hold-out data: 0.5952500104904175
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2047866644620895
Accuracy on hold-out set: 0.58395
MulticlassAccuracy value on hold-out data: 0.5839499831199646
Epoch: 9</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1512282137155534
Accuracy on hold-out set: 0.6
MulticlassAccuracy value on hold-out data: 0.6000000238418579
Epoch: 10</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1410926800966263
Accuracy on hold-out set: 0.60695
MulticlassAccuracy value on hold-out data: 0.6069499850273132
Epoch: 11</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.178787278699875
Accuracy on hold-out set: 0.59355
MulticlassAccuracy value on hold-out data: 0.5935500264167786
Epoch: 12</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2072421681880952
Accuracy on hold-out set: 0.5944
MulticlassAccuracy value on hold-out data: 0.5943999886512756
Epoch: 13</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.173101697587967
Accuracy on hold-out set: 0.60135
MulticlassAccuracy value on hold-out data: 0.6013500094413757
Early stopping at epoch 12
Returned to Spot: Validation loss: 1.173101697587967
----------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>spotPython tuning: 1.173101697587967 [####------] 36.62% </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
config: {'l1': 4, 'l2': 64, 'lr_mult': 1.0, 'batch_size': 32, 'epochs': 16, 'k_folds': 0, 'patience': 3, 'optimizer': 'AdamW', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.6226150213241577
Accuracy on hold-out set: 0.39105
MulticlassAccuracy value on hold-out data: 0.3910500109195709
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.5156013435363769
Accuracy on hold-out set: 0.4313
MulticlassAccuracy value on hold-out data: 0.43130001425743103
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.4325028928756713
Accuracy on hold-out set: 0.463
MulticlassAccuracy value on hold-out data: 0.46299999952316284
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3903947087287902
Accuracy on hold-out set: 0.4792
MulticlassAccuracy value on hold-out data: 0.47920000553131104
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3774570764541625
Accuracy on hold-out set: 0.4875
MulticlassAccuracy value on hold-out data: 0.48750001192092896
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3664662029266357
Accuracy on hold-out set: 0.49485
MulticlassAccuracy value on hold-out data: 0.4948500096797943
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3878898769378663
Accuracy on hold-out set: 0.4792
MulticlassAccuracy value on hold-out data: 0.47920000553131104
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.344132685279846
Accuracy on hold-out set: 0.49905
MulticlassAccuracy value on hold-out data: 0.49904999136924744
Epoch: 9</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3085883013725281
Accuracy on hold-out set: 0.51515
MulticlassAccuracy value on hold-out data: 0.5151500105857849
Epoch: 10</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3518012718200683
Accuracy on hold-out set: 0.49655
MulticlassAccuracy value on hold-out data: 0.4965499937534332
Epoch: 11</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.303925577068329
Accuracy on hold-out set: 0.5153
MulticlassAccuracy value on hold-out data: 0.5152999758720398
Epoch: 12</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2804302824020386
Accuracy on hold-out set: 0.52605
MulticlassAccuracy value on hold-out data: 0.5260499715805054
Epoch: 13</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2829505469322204
Accuracy on hold-out set: 0.52715
MulticlassAccuracy value on hold-out data: 0.5271499752998352
Epoch: 14</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2925728231430054
Accuracy on hold-out set: 0.5252
MulticlassAccuracy value on hold-out data: 0.5252000093460083
Epoch: 15</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2516523637771606
Accuracy on hold-out set: 0.53405
MulticlassAccuracy value on hold-out data: 0.5340499877929688
Epoch: 16</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2586891078948974
Accuracy on hold-out set: 0.5389
MulticlassAccuracy value on hold-out data: 0.5389000177383423
Returned to Spot: Validation loss: 1.2586891078948974
----------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>spotPython tuning: 1.173101697587967 [#####-----] 46.41% </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
config: {'l1': 512, 'l2': 512, 'lr_mult': 1.0, 'batch_size': 16, 'epochs': 16, 'k_folds': 0, 'patience': 3, 'optimizer': 'AdamW', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3859094167709352
Accuracy on hold-out set: 0.4948
MulticlassAccuracy value on hold-out data: 0.49480000138282776
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3084599166870117
Accuracy on hold-out set: 0.53885
MulticlassAccuracy value on hold-out data: 0.5388500094413757
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2569380239248276
Accuracy on hold-out set: 0.56075
MulticlassAccuracy value on hold-out data: 0.5607500076293945
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2008638921260835
Accuracy on hold-out set: 0.58195
MulticlassAccuracy value on hold-out data: 0.5819500088691711
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1793278839111327
Accuracy on hold-out set: 0.5943
MulticlassAccuracy value on hold-out data: 0.5942999720573425
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1956181304454803
Accuracy on hold-out set: 0.609
MulticlassAccuracy value on hold-out data: 0.609000027179718
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2681621943235397
Accuracy on hold-out set: 0.59915
MulticlassAccuracy value on hold-out data: 0.5991500020027161
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.4033361210107804
Accuracy on hold-out set: 0.5902
MulticlassAccuracy value on hold-out data: 0.5902000069618225
Early stopping at epoch 7
Returned to Spot: Validation loss: 1.4033361210107804
----------------------------------------------
spotPython tuning: 1.173101697587967 [#####-----] 53.37% </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
config: {'l1': 16, 'l2': 128, 'lr_mult': 1.0, 'batch_size': 16, 'epochs': 16, 'k_folds': 0, 'patience': 3, 'optimizer': 'AdamW', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.50163823056221
Accuracy on hold-out set: 0.45285
MulticlassAccuracy value on hold-out data: 0.45285001397132874
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.4629781801223756
Accuracy on hold-out set: 0.4827
MulticlassAccuracy value on hold-out data: 0.482699990272522
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3330827356815338
Accuracy on hold-out set: 0.51915
MulticlassAccuracy value on hold-out data: 0.5191500186920166
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3042912577152252
Accuracy on hold-out set: 0.5294
MulticlassAccuracy value on hold-out data: 0.5293999910354614
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3167204762935638
Accuracy on hold-out set: 0.52805
MulticlassAccuracy value on hold-out data: 0.5280500054359436
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2452145859718322
Accuracy on hold-out set: 0.5545
MulticlassAccuracy value on hold-out data: 0.5544999837875366
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2154634838581084
Accuracy on hold-out set: 0.56645
MulticlassAccuracy value on hold-out data: 0.5664499998092651
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2069166351795197
Accuracy on hold-out set: 0.5699
MulticlassAccuracy value on hold-out data: 0.5698999762535095
Epoch: 9</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2354827906370163
Accuracy on hold-out set: 0.57335
MulticlassAccuracy value on hold-out data: 0.5733500123023987
Epoch: 10</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1957695059537887
Accuracy on hold-out set: 0.5793
MulticlassAccuracy value on hold-out data: 0.5792999863624573
Epoch: 11</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1772377661705018
Accuracy on hold-out set: 0.5871
MulticlassAccuracy value on hold-out data: 0.5871000289916992
Epoch: 12</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1675749730825424
Accuracy on hold-out set: 0.58645
MulticlassAccuracy value on hold-out data: 0.5864499807357788
Epoch: 13</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1668046678304673
Accuracy on hold-out set: 0.5931
MulticlassAccuracy value on hold-out data: 0.5931000113487244
Epoch: 14</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2392135566949845
Accuracy on hold-out set: 0.56945
MulticlassAccuracy value on hold-out data: 0.5694500207901001
Epoch: 15</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.143719405269623
Accuracy on hold-out set: 0.597
MulticlassAccuracy value on hold-out data: 0.597000002861023
Epoch: 16</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1767093319892883
Accuracy on hold-out set: 0.58885
MulticlassAccuracy value on hold-out data: 0.5888500213623047
Returned to Spot: Validation loss: 1.1767093319892883
----------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>spotPython tuning: 1.173101697587967 [######----] 64.66% </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
config: {'l1': 32, 'l2': 64, 'lr_mult': 1.0, 'batch_size': 16, 'epochs': 16, 'k_folds': 0, 'patience': 3, 'optimizer': 'AdamW', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.5119601490974426
Accuracy on hold-out set: 0.4423
MulticlassAccuracy value on hold-out data: 0.4422999918460846
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3535101760864259
Accuracy on hold-out set: 0.51035
MulticlassAccuracy value on hold-out data: 0.5103499889373779
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2928748548507691
Accuracy on hold-out set: 0.5385
MulticlassAccuracy value on hold-out data: 0.5385000109672546
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2824455682992935
Accuracy on hold-out set: 0.5497
MulticlassAccuracy value on hold-out data: 0.5497000217437744
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.208276400732994
Accuracy on hold-out set: 0.5728
MulticlassAccuracy value on hold-out data: 0.5727999806404114
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1729432007312774
Accuracy on hold-out set: 0.58785
MulticlassAccuracy value on hold-out data: 0.5878499746322632
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1892239879369735
Accuracy on hold-out set: 0.57775
MulticlassAccuracy value on hold-out data: 0.577750027179718
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.164001667714119
Accuracy on hold-out set: 0.58995
MulticlassAccuracy value on hold-out data: 0.5899500250816345
Epoch: 9</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.144117252755165
Accuracy on hold-out set: 0.5968
MulticlassAccuracy value on hold-out data: 0.5968000292778015
Epoch: 10</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1417374807834626
Accuracy on hold-out set: 0.6019
MulticlassAccuracy value on hold-out data: 0.6018999814987183
Epoch: 11</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1576101055979728
Accuracy on hold-out set: 0.59125
MulticlassAccuracy value on hold-out data: 0.5912500023841858
Epoch: 12</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1774953495502472
Accuracy on hold-out set: 0.593
MulticlassAccuracy value on hold-out data: 0.5929999947547913
Epoch: 13</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1590280144691467
Accuracy on hold-out set: 0.5987
MulticlassAccuracy value on hold-out data: 0.5986999869346619
Early stopping at epoch 12
Returned to Spot: Validation loss: 1.1590280144691467
----------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>spotPython tuning: 1.1590280144691467 [#######---] 74.05% </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
config: {'l1': 32, 'l2': 64, 'lr_mult': 1.0, 'batch_size': 32, 'epochs': 16, 'k_folds': 0, 'patience': 3, 'optimizer': 'AdamW', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.5969278493881225
Accuracy on hold-out set: 0.41915
MulticlassAccuracy value on hold-out data: 0.4191499948501587
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.4429768196105957
Accuracy on hold-out set: 0.47605
MulticlassAccuracy value on hold-out data: 0.4760499894618988
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.359341883277893
Accuracy on hold-out set: 0.5094
MulticlassAccuracy value on hold-out data: 0.5094000101089478
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3306642253875733
Accuracy on hold-out set: 0.52815
MulticlassAccuracy value on hold-out data: 0.5281500220298767
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.29293729763031
Accuracy on hold-out set: 0.5385
MulticlassAccuracy value on hold-out data: 0.5385000109672546
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2112073586463927
Accuracy on hold-out set: 0.56945
MulticlassAccuracy value on hold-out data: 0.5694500207901001
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2407475979804992
Accuracy on hold-out set: 0.56155
MulticlassAccuracy value on hold-out data: 0.5615500211715698
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1786227509498597
Accuracy on hold-out set: 0.58535
MulticlassAccuracy value on hold-out data: 0.585349977016449
Epoch: 9</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1752745832443237
Accuracy on hold-out set: 0.5876
MulticlassAccuracy value on hold-out data: 0.5875999927520752
Epoch: 10</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1731052838802338
Accuracy on hold-out set: 0.59365
MulticlassAccuracy value on hold-out data: 0.5936499834060669
Epoch: 11</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1381336972236633
Accuracy on hold-out set: 0.6019
MulticlassAccuracy value on hold-out data: 0.6018999814987183
Epoch: 12</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.159678161048889
Accuracy on hold-out set: 0.59665
MulticlassAccuracy value on hold-out data: 0.5966500043869019
Epoch: 13</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1422260280609131
Accuracy on hold-out set: 0.5971
MulticlassAccuracy value on hold-out data: 0.597100019454956
Epoch: 14</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1201010601997377
Accuracy on hold-out set: 0.61055
MulticlassAccuracy value on hold-out data: 0.6105499863624573
Epoch: 15</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1607105719089508
Accuracy on hold-out set: 0.5942
MulticlassAccuracy value on hold-out data: 0.5942000150680542
Epoch: 16</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1112337918281556
Accuracy on hold-out set: 0.61195
MulticlassAccuracy value on hold-out data: 0.6119499802589417
Returned to Spot: Validation loss: 1.1112337918281556
----------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>spotPython tuning: 1.1112337918281556 [########--] 83.88% </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
config: {'l1': 32, 'l2': 128, 'lr_mult': 1.0, 'batch_size': 32, 'epochs': 16, 'k_folds': 0, 'patience': 3, 'optimizer': 'AdamW', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.5478447868347167
Accuracy on hold-out set: 0.4323
MulticlassAccuracy value on hold-out data: 0.43230000138282776
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.4247279371261596
Accuracy on hold-out set: 0.47955
MulticlassAccuracy value on hold-out data: 0.47955000400543213
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.336058818912506
Accuracy on hold-out set: 0.5218
MulticlassAccuracy value on hold-out data: 0.5217999815940857
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2712731137275697
Accuracy on hold-out set: 0.55135
MulticlassAccuracy value on hold-out data: 0.5513499975204468
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2226607837677002
Accuracy on hold-out set: 0.56815
MulticlassAccuracy value on hold-out data: 0.568149983882904
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2355902368545533
Accuracy on hold-out set: 0.56365
MulticlassAccuracy value on hold-out data: 0.5636500120162964
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1664306200027466
Accuracy on hold-out set: 0.58865
MulticlassAccuracy value on hold-out data: 0.5886499881744385
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.199628316783905
Accuracy on hold-out set: 0.5743
MulticlassAccuracy value on hold-out data: 0.5742999911308289
Epoch: 9</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1859040815353394
Accuracy on hold-out set: 0.58725
MulticlassAccuracy value on hold-out data: 0.5872499942779541
Epoch: 10</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1459507223129273
Accuracy on hold-out set: 0.6044
MulticlassAccuracy value on hold-out data: 0.6043999791145325
Epoch: 11</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1218714394569398
Accuracy on hold-out set: 0.6064
MulticlassAccuracy value on hold-out data: 0.6064000129699707
Epoch: 12</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1523362829208375
Accuracy on hold-out set: 0.60055
MulticlassAccuracy value on hold-out data: 0.6005499958992004
Epoch: 13</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.11508677110672
Accuracy on hold-out set: 0.61255
MulticlassAccuracy value on hold-out data: 0.6125500202178955
Epoch: 14</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.150922962474823
Accuracy on hold-out set: 0.603
MulticlassAccuracy value on hold-out data: 0.6029999852180481
Epoch: 15</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1595768379211426
Accuracy on hold-out set: 0.601
MulticlassAccuracy value on hold-out data: 0.6010000109672546
Epoch: 16</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1175544973373412
Accuracy on hold-out set: 0.6176
MulticlassAccuracy value on hold-out data: 0.6176000237464905
Early stopping at epoch 15
Returned to Spot: Validation loss: 1.1175544973373412
----------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>spotPython tuning: 1.1112337918281556 [#########-] 93.81% </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
config: {'l1': 64, 'l2': 4, 'lr_mult': 1.0, 'batch_size': 8, 'epochs': 8, 'k_folds': 0, 'patience': 3, 'optimizer': 'AdamW', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.3026317724227905
Accuracy on hold-out set: 0.1013
MulticlassAccuracy value on hold-out data: 0.10130000114440918
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.3027376378059388
Accuracy on hold-out set: 0.09795
MulticlassAccuracy value on hold-out data: 0.09794999659061432
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.3029168005943297
Accuracy on hold-out set: 0.09815
MulticlassAccuracy value on hold-out data: 0.09814999997615814
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.3031554979324342
Accuracy on hold-out set: 0.0995
MulticlassAccuracy value on hold-out data: 0.09950000047683716
Early stopping at epoch 3
Returned to Spot: Validation loss: 2.3031554979324342
----------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>spotPython tuning: 1.1112337918281556 [##########] 96.13% </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
config: {'l1': 8, 'l2': 512, 'lr_mult': 1.0, 'batch_size': 16, 'epochs': 16, 'k_folds': 0, 'patience': 3, 'optimizer': 'NAdam', 'sgd_momentum': 0.9}
Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.443802201795578
Accuracy on hold-out set: 0.46585
MulticlassAccuracy value on hold-out data: 0.46584999561309814
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3793369000911713
Accuracy on hold-out set: 0.4983
MulticlassAccuracy value on hold-out data: 0.4982999861240387
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.321274983072281
Accuracy on hold-out set: 0.51835
MulticlassAccuracy value on hold-out data: 0.5183500051498413
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3934255885124207
Accuracy on hold-out set: 0.50095
MulticlassAccuracy value on hold-out data: 0.5009499788284302
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.3057110221385957
Accuracy on hold-out set: 0.5352
MulticlassAccuracy value on hold-out data: 0.5351999998092651
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2474714047431945
Accuracy on hold-out set: 0.55105
MulticlassAccuracy value on hold-out data: 0.5510500073432922
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2338773973941803
Accuracy on hold-out set: 0.5607
MulticlassAccuracy value on hold-out data: 0.560699999332428
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2474857745409011
Accuracy on hold-out set: 0.55915
MulticlassAccuracy value on hold-out data: 0.559149980545044
Epoch: 9</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2384405407428742
Accuracy on hold-out set: 0.56505
MulticlassAccuracy value on hold-out data: 0.5650500059127808
Epoch: 10</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2279422499895096
Accuracy on hold-out set: 0.5678
MulticlassAccuracy value on hold-out data: 0.567799985408783
Epoch: 11</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2342207060098649
Accuracy on hold-out set: 0.57065
MulticlassAccuracy value on hold-out data: 0.5706499814987183
Epoch: 12</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.215912817621231
Accuracy on hold-out set: 0.56915
MulticlassAccuracy value on hold-out data: 0.5691499710083008
Epoch: 13</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2128731129407884
Accuracy on hold-out set: 0.5781
MulticlassAccuracy value on hold-out data: 0.5781000256538391
Epoch: 14</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2394779655933381
Accuracy on hold-out set: 0.57315
MulticlassAccuracy value on hold-out data: 0.5731499791145325
Epoch: 15</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.256415672135353
Accuracy on hold-out set: 0.57335
MulticlassAccuracy value on hold-out data: 0.5733500123023987
Epoch: 16</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2154606033802033
Accuracy on hold-out set: 0.57725
MulticlassAccuracy value on hold-out data: 0.5772500038146973
Early stopping at epoch 15
Returned to Spot: Validation loss: 1.2154606033802033
----------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>spotPython tuning: 1.1112337918281556 [##########] 100.00% Done...
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>&lt;spotPython.spot.spot.Spot at 0x28e513460&gt;</code></pre>
</div>
</div>
</section>
<section id="sec-tensorboard-14" class="level2" data-number="13.13">
<h2 data-number="13.13" class="anchored" data-anchor-id="sec-tensorboard-14"><span class="header-section-number">13.13</span> Tensorboard</h2>
<p>The textual output shown in the console (or code cell) can be visualized with Tensorboard.</p>
<section id="tensorboard-start-tensorboard" class="level3" data-number="13.13.1">
<h3 data-number="13.13.1" class="anchored" data-anchor-id="tensorboard-start-tensorboard"><span class="header-section-number">13.13.1</span> Tensorboard: Start Tensorboard</h3>
<p>Start TensorBoard through the command line to visualize data you logged. Specify the root log directory as used in <code>fun_control = fun_control_init(task="regression", tensorboard_path="runs/24_spot_torch_regression")</code> as the <code>tensorboard_path</code>. The argument logdir points to directory where TensorBoard will look to find event files that it can display. TensorBoard will recursively walk the directory structure rooted at logdir, looking for .<em>tfevents.</em> files.</p>
<pre class="{raw}"><code>tensorboard --logdir=runs</code></pre>
<p>Go to the URL it provides or to <a href="http://localhost:6006/">http://localhost:6006/</a>. The following figures show some screenshots of Tensorboard.</p>
<div id="fig-tensorboard_0" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="./figures/14-torch_p040025_10min_5init_2023-06-07_12-41-06_tensorboard_01.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;13.1: Tensorboard</figcaption>
</figure>
</div>
<div id="fig-tensorboard_hdparams" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="./figures/14-torch_p040025_10min_5init_2023-06-07_12-41-06_tensorboard_02.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;13.2: Tensorboard</figcaption>
</figure>
</div>
</section>
<section id="sec-saving-the-state-of-the-notebook" class="level3" data-number="13.13.2">
<h3 data-number="13.13.2" class="anchored" data-anchor-id="sec-saving-the-state-of-the-notebook"><span class="header-section-number">13.13.2</span> Saving the State of the Notebook</h3>
<p>The state of the notebook can be saved and reloaded as follows:</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a>SAVE <span class="op">=</span> <span class="va">False</span></span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true" tabindex="-1"></a>LOAD <span class="op">=</span> <span class="va">False</span></span>
<span id="cb310-4"><a href="#cb310-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-5"><a href="#cb310-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> SAVE:</span>
<span id="cb310-6"><a href="#cb310-6" aria-hidden="true" tabindex="-1"></a>    result_file_name <span class="op">=</span> <span class="st">"res_"</span> <span class="op">+</span> experiment_name <span class="op">+</span> <span class="st">".pkl"</span></span>
<span id="cb310-7"><a href="#cb310-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(result_file_name, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb310-8"><a href="#cb310-8" aria-hidden="true" tabindex="-1"></a>        pickle.dump(spot_tuner, f)</span>
<span id="cb310-9"><a href="#cb310-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-10"><a href="#cb310-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> LOAD:</span>
<span id="cb310-11"><a href="#cb310-11" aria-hidden="true" tabindex="-1"></a>    result_file_name <span class="op">=</span> <span class="st">"add_the_name_of_the_result_file_here.pkl"</span></span>
<span id="cb310-12"><a href="#cb310-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(result_file_name, <span class="st">'rb'</span>) <span class="im">as</span> f:</span>
<span id="cb310-13"><a href="#cb310-13" aria-hidden="true" tabindex="-1"></a>        spot_tuner <span class="op">=</span>  pickle.load(f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="sec-results-14" class="level2" data-number="13.14">
<h2 data-number="13.14" class="anchored" data-anchor-id="sec-results-14"><span class="header-section-number">13.14</span> Results</h2>
<p>After the hyperparameter tuning run is finished, the progress of the hyperparameter tuning can be visualized. The following code generates the progress plot from <span class="quarto-unresolved-ref">?fig-progress</span>.</p>
<div class="cell" data-fig-label="fig-progress" data-execution_count="24">
<div class="sourceCode cell-code" id="cb311"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a>spot_tuner.plot_progress(log_y<span class="op">=</span><span class="va">False</span>, </span>
<span id="cb311-2"><a href="#cb311-2" aria-hidden="true" tabindex="-1"></a>    filename<span class="op">=</span><span class="st">"./figures/"</span> <span class="op">+</span> experiment_name<span class="op">+</span><span class="st">"_progress.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="14_spot_ray_hpt_torch_cifar10_files/figure-html/cell-25-output-1.png" width="719" height="243" class="figure-img"></p>
<figcaption class="figure-caption">Progress plot. <em>Black</em> dots denote results from the initial design. <em>Red</em> dots illustrate the improvement found by the surrogate model based optimization.</figcaption>
</figure>
</div>
</div>
</div>
<p><span class="quarto-unresolved-ref">?fig-progress</span> shows a typical behaviour that can be observed in many hyperparameter studies <span class="citation" data-cites="bart21i">(<a href="references.html#ref-bart21i" role="doc-biblioref">Bartz et al. 2022</a>)</span>: the largest improvement is obtained during the evaluation of the initial design. The surrogate model based optimization-optimization with the surrogate refines the results. <span class="quarto-unresolved-ref">?fig-progress</span> also illustrates one major difference between <code>ray[tune]</code> as used in <span class="citation" data-cites="pyto23a">PyTorch (<a href="references.html#ref-pyto23a" role="doc-biblioref">2023a</a>)</span> and <code>spotPython</code>: the <code>ray[tune]</code> uses a random search and will generate results similar to the <em>black</em> dots, whereas <code>spotPython</code> uses a surrogate model based optimization and presents results represented by <em>red</em> dots in <span class="quarto-unresolved-ref">?fig-progress</span>. The surrogate model based optimization is considered to be more efficient than a random search, because the surrogate model guides the search towards promising regions in the hyperparameter space.</p>
<p>In addition to the improved (“optimized”) hyperparameter values, <code>spotPython</code> allows a statistical analysis, e.g., a sensitivity analysis, of the results. We can print the results of the hyperparameter tuning, see <span class="quarto-unresolved-ref">?tbl-results</span>. The table shows the hyperparameters, their types, default values, lower and upper bounds, and the transformation function. The column “tuned” shows the tuned values. The column “importance” shows the importance of the hyperparameters. The column “stars” shows the importance of the hyperparameters in stars. The importance is computed by the SPOT software.</p>
<div class="cell" data-fig-label="tbl-results" data-execution_count="25">
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotPython.utils.eda <span class="im">import</span> gen_design_table</span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gen_design_table(fun_control<span class="op">=</span>fun_control, spot<span class="op">=</span>spot_tuner))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>| name         | type   | default   |   lower |   upper |   tuned | transform             |   importance | stars   |
|--------------|--------|-----------|---------|---------|---------|-----------------------|--------------|---------|
| l1           | int    | 5         |     2.0 |     9.0 |     5.0 | transform_power_2_int |         5.62 | *       |
| l2           | int    | 5         |     2.0 |     9.0 |     6.0 | transform_power_2_int |         6.13 | *       |
| lr_mult      | float  | 1.0       |     1.0 |     1.0 |     1.0 | None                  |         0.00 |         |
| batch_size   | int    | 4         |     1.0 |     5.0 |     5.0 | transform_power_2_int |         0.63 | .       |
| epochs       | int    | 3         |     3.0 |     4.0 |     4.0 | transform_power_2_int |       100.00 | ***     |
| k_folds      | int    | 1         |     0.0 |     0.0 |     0.0 | None                  |         0.00 |         |
| patience     | int    | 5         |     3.0 |     3.0 |     3.0 | None                  |         0.00 |         |
| optimizer    | factor | SGD       |     0.0 |     9.0 |     3.0 | None                  |         0.05 |         |
| sgd_momentum | float  | 0.0       |     0.9 |     0.9 |     0.9 | None                  |         0.00 |         |</code></pre>
</div>
</div>
<p>To visualize the most important hyperparameters, <code>spotPython</code> provides the function <code>plot_importance</code>. The following code generates the importance plot from <span class="quarto-unresolved-ref">?fig-importance</span>.</p>
<div class="cell" data-fig-label="fig-importance" data-execution_count="26">
<div class="sourceCode cell-code" id="cb314"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a>spot_tuner.plot_importance(threshold<span class="op">=</span><span class="fl">0.025</span>,</span>
<span id="cb314-2"><a href="#cb314-2" aria-hidden="true" tabindex="-1"></a>    filename<span class="op">=</span><span class="st">"./figures/"</span> <span class="op">+</span> experiment_name<span class="op">+</span><span class="st">"_importance.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="14_spot_ray_hpt_torch_cifar10_files/figure-html/cell-27-output-1.png" width="575" height="411" class="figure-img"></p>
<figcaption class="figure-caption">Variable importance plot, threshold 0.025.</figcaption>
</figure>
</div>
</div>
</div>
<section id="sec-get-spot-results-14" class="level3" data-number="13.14.1">
<h3 data-number="13.14.1" class="anchored" data-anchor-id="sec-get-spot-results-14"><span class="header-section-number">13.14.1</span> Get the Tuned Architecture (SPOT Results)</h3>
<p>The architecture of the <code>spotPython</code> model can be obtained as follows. First, the numerical representation of the hyperparameters are obtained, i.e., the numpy array <code>X</code> is generated. This array is then used to generate the model <code>model_spot</code> by the function <code>get_one_core_model_from_X</code>. The model <code>model_spot</code> has the following architecture:</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotPython.hyperparameters.values <span class="im">import</span> get_one_core_model_from_X</span>
<span id="cb315-2"><a href="#cb315-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> spot_tuner.to_all_dim(spot_tuner.min_X.reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb315-3"><a href="#cb315-3" aria-hidden="true" tabindex="-1"></a>model_spot <span class="op">=</span> get_one_core_model_from_X(X, fun_control)</span>
<span id="cb315-4"><a href="#cb315-4" aria-hidden="true" tabindex="-1"></a>model_spot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>Net_CIFAR10(
  (conv1): Conv2d(3, 6, kernel_size=(5, 5), stride=(1, 1))
  (pool): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)
  (conv2): Conv2d(6, 16, kernel_size=(5, 5), stride=(1, 1))
  (fc1): Linear(in_features=400, out_features=32, bias=True)
  (fc2): Linear(in_features=32, out_features=64, bias=True)
  (fc3): Linear(in_features=64, out_features=10, bias=True)
)</code></pre>
</div>
</div>
</section>
<section id="get-default-hyperparameters" class="level3" data-number="13.14.2">
<h3 data-number="13.14.2" class="anchored" data-anchor-id="get-default-hyperparameters"><span class="header-section-number">13.14.2</span> Get Default Hyperparameters</h3>
<p>In a similar manner as in <span class="quarto-unresolved-ref">?sec-get-spot-results</span>, the default hyperparameters can be obtained.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fun_control was modified, we generate a new one with the original </span></span>
<span id="cb317-2"><a href="#cb317-2" aria-hidden="true" tabindex="-1"></a><span class="co"># default hyperparameters</span></span>
<span id="cb317-3"><a href="#cb317-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotPython.hyperparameters.values <span class="im">import</span> get_one_core_model_from_X</span>
<span id="cb317-4"><a href="#cb317-4" aria-hidden="true" tabindex="-1"></a>fc <span class="op">=</span> fun_control</span>
<span id="cb317-5"><a href="#cb317-5" aria-hidden="true" tabindex="-1"></a>fc.update({<span class="st">"core_model_hyper_dict"</span>:</span>
<span id="cb317-6"><a href="#cb317-6" aria-hidden="true" tabindex="-1"></a>    hyper_dict[fun_control[<span class="st">"core_model"</span>].<span class="va">__name__</span>]})</span>
<span id="cb317-7"><a href="#cb317-7" aria-hidden="true" tabindex="-1"></a>model_default <span class="op">=</span> get_one_core_model_from_X(X_start, fun_control<span class="op">=</span>fc)</span>
<span id="cb317-8"><a href="#cb317-8" aria-hidden="true" tabindex="-1"></a>model_default</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>Net_CIFAR10(
  (conv1): Conv2d(3, 6, kernel_size=(5, 5), stride=(1, 1))
  (pool): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)
  (conv2): Conv2d(6, 16, kernel_size=(5, 5), stride=(1, 1))
  (fc1): Linear(in_features=400, out_features=32, bias=True)
  (fc2): Linear(in_features=32, out_features=32, bias=True)
  (fc3): Linear(in_features=32, out_features=10, bias=True)
)</code></pre>
</div>
</div>
</section>
<section id="evaluation-of-the-default-architecture" class="level3" data-number="13.14.3">
<h3 data-number="13.14.3" class="anchored" data-anchor-id="evaluation-of-the-default-architecture"><span class="header-section-number">13.14.3</span> Evaluation of the Default Architecture</h3>
<p>The method <code>train_tuned</code> takes a model architecture without trained weights and trains this model with the train data. The train data is split into train and validation data. The validation data is used for early stopping. The trained model weights are saved as a dictionary.</p>
<p>This evaluation is similar to the final evaluation in <span class="citation" data-cites="pyto23a">PyTorch (<a href="references.html#ref-pyto23a" role="doc-biblioref">2023a</a>)</span>.</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb319"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotPython.torch.traintest <span class="im">import</span> (</span>
<span id="cb319-2"><a href="#cb319-2" aria-hidden="true" tabindex="-1"></a>    train_tuned,</span>
<span id="cb319-3"><a href="#cb319-3" aria-hidden="true" tabindex="-1"></a>    test_tuned,</span>
<span id="cb319-4"><a href="#cb319-4" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb319-5"><a href="#cb319-5" aria-hidden="true" tabindex="-1"></a>train_tuned(net<span class="op">=</span>model_default, train_dataset<span class="op">=</span>train, shuffle<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb319-6"><a href="#cb319-6" aria-hidden="true" tabindex="-1"></a>        loss_function<span class="op">=</span>fun_control[<span class="st">"loss_function"</span>],</span>
<span id="cb319-7"><a href="#cb319-7" aria-hidden="true" tabindex="-1"></a>        metric<span class="op">=</span>fun_control[<span class="st">"metric_torch"</span>],</span>
<span id="cb319-8"><a href="#cb319-8" aria-hidden="true" tabindex="-1"></a>        device <span class="op">=</span> fun_control[<span class="st">"device"</span>], show_batch_interval<span class="op">=</span><span class="dv">1_000_000</span>,</span>
<span id="cb319-9"><a href="#cb319-9" aria-hidden="true" tabindex="-1"></a>        path<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb319-10"><a href="#cb319-10" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span>fun_control[<span class="st">"task"</span>],)</span>
<span id="cb319-11"><a href="#cb319-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-12"><a href="#cb319-12" aria-hidden="true" tabindex="-1"></a>test_tuned(net<span class="op">=</span>model_default, test_dataset<span class="op">=</span>test, </span>
<span id="cb319-13"><a href="#cb319-13" aria-hidden="true" tabindex="-1"></a>        loss_function<span class="op">=</span>fun_control[<span class="st">"loss_function"</span>],</span>
<span id="cb319-14"><a href="#cb319-14" aria-hidden="true" tabindex="-1"></a>        metric<span class="op">=</span>fun_control[<span class="st">"metric_torch"</span>],</span>
<span id="cb319-15"><a href="#cb319-15" aria-hidden="true" tabindex="-1"></a>        shuffle<span class="op">=</span><span class="va">False</span>, </span>
<span id="cb319-16"><a href="#cb319-16" aria-hidden="true" tabindex="-1"></a>        device <span class="op">=</span> fun_control[<span class="st">"device"</span>],</span>
<span id="cb319-17"><a href="#cb319-17" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span>fun_control[<span class="st">"task"</span>],)        </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.3059939056396486
Accuracy on hold-out set: 0.1143
MulticlassAccuracy value on hold-out data: 0.11429999768733978
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.3010946350097656
Accuracy on hold-out set: 0.1101
MulticlassAccuracy value on hold-out data: 0.11010000109672546
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.292931368255615
Accuracy on hold-out set: 0.11565
MulticlassAccuracy value on hold-out data: 0.1156499981880188
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.2728519828796387
Accuracy on hold-out set: 0.14455
MulticlassAccuracy value on hold-out data: 0.14454999566078186
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.2270529048919676
Accuracy on hold-out set: 0.147
MulticlassAccuracy value on hold-out data: 0.1469999998807907
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.1787823093414307
Accuracy on hold-out set: 0.17165
MulticlassAccuracy value on hold-out data: 0.1716500073671341
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.143781774520874
Accuracy on hold-out set: 0.20205
MulticlassAccuracy value on hold-out data: 0.20205000042915344
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.1199397923469543
Accuracy on hold-out set: 0.21655
MulticlassAccuracy value on hold-out data: 0.21654999256134033
Returned to Spot: Validation loss: 2.1199397923469543
----------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 2.1146215215682984
Accuracy on hold-out set: 0.22
MulticlassAccuracy value on hold-out data: 0.2199999988079071
Final evaluation: Validation loss: 2.1146215215682984
Final evaluation: Validation metric: 0.2199999988079071
----------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>(2.1146215215682984, nan, tensor(0.2200))</code></pre>
</div>
</div>
</section>
<section id="evaluation-of-the-tuned-architecture" class="level3" data-number="13.14.4">
<h3 data-number="13.14.4" class="anchored" data-anchor-id="evaluation-of-the-tuned-architecture"><span class="header-section-number">13.14.4</span> Evaluation of the Tuned Architecture</h3>
<p>The following code trains the model <code>model_spot</code>.</p>
<p>If <code>path</code> is set to a filename, e.g., <code>path = "model_spot_trained.pt"</code>, the weights of the trained model will be saved to this file.</p>
<p>If <code>path</code> is set to a filename, e.g., <code>path = "model_spot_trained.pt"</code>, the weights of the trained model will be loaded from this file.</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb331"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a>train_tuned(net<span class="op">=</span>model_spot, train_dataset<span class="op">=</span>train,</span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a>        loss_function<span class="op">=</span>fun_control[<span class="st">"loss_function"</span>],</span>
<span id="cb331-3"><a href="#cb331-3" aria-hidden="true" tabindex="-1"></a>        metric<span class="op">=</span>fun_control[<span class="st">"metric_torch"</span>],</span>
<span id="cb331-4"><a href="#cb331-4" aria-hidden="true" tabindex="-1"></a>        shuffle<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb331-5"><a href="#cb331-5" aria-hidden="true" tabindex="-1"></a>        device <span class="op">=</span> fun_control[<span class="st">"device"</span>],</span>
<span id="cb331-6"><a href="#cb331-6" aria-hidden="true" tabindex="-1"></a>        path<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb331-7"><a href="#cb331-7" aria-hidden="true" tabindex="-1"></a>        task<span class="op">=</span>fun_control[<span class="st">"task"</span>],)</span>
<span id="cb331-8"><a href="#cb331-8" aria-hidden="true" tabindex="-1"></a>test_tuned(net<span class="op">=</span>model_spot, test_dataset<span class="op">=</span>test,</span>
<span id="cb331-9"><a href="#cb331-9" aria-hidden="true" tabindex="-1"></a>            shuffle<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb331-10"><a href="#cb331-10" aria-hidden="true" tabindex="-1"></a>            loss_function<span class="op">=</span>fun_control[<span class="st">"loss_function"</span>],</span>
<span id="cb331-11"><a href="#cb331-11" aria-hidden="true" tabindex="-1"></a>            metric<span class="op">=</span>fun_control[<span class="st">"metric_torch"</span>],</span>
<span id="cb331-12"><a href="#cb331-12" aria-hidden="true" tabindex="-1"></a>            device <span class="op">=</span> fun_control[<span class="st">"device"</span>],</span>
<span id="cb331-13"><a href="#cb331-13" aria-hidden="true" tabindex="-1"></a>            task<span class="op">=</span>fun_control[<span class="st">"task"</span>],)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch: 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.5367841676712035
Accuracy on hold-out set: 0.4464
MulticlassAccuracy value on hold-out data: 0.446399986743927
Epoch: 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.4369130460739137
Accuracy on hold-out set: 0.48825
MulticlassAccuracy value on hold-out data: 0.4882499873638153
Epoch: 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.322485485935211
Accuracy on hold-out set: 0.5274
MulticlassAccuracy value on hold-out data: 0.527400016784668
Epoch: 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2750712456703186
Accuracy on hold-out set: 0.54975
MulticlassAccuracy value on hold-out data: 0.5497499704360962
Epoch: 5</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.278616949081421
Accuracy on hold-out set: 0.54925
MulticlassAccuracy value on hold-out data: 0.5492500066757202
Epoch: 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.2618403136253358
Accuracy on hold-out set: 0.55655
MulticlassAccuracy value on hold-out data: 0.5565500259399414
Epoch: 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.218701737689972
Accuracy on hold-out set: 0.5767
MulticlassAccuracy value on hold-out data: 0.57669997215271
Epoch: 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1871091922760009
Accuracy on hold-out set: 0.58135
MulticlassAccuracy value on hold-out data: 0.5813500285148621
Epoch: 9</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.211964674282074
Accuracy on hold-out set: 0.5793
MulticlassAccuracy value on hold-out data: 0.5792999863624573
Epoch: 10</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1984187335968017
Accuracy on hold-out set: 0.5831
MulticlassAccuracy value on hold-out data: 0.5831000208854675
Epoch: 11</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.168288896369934
Accuracy on hold-out set: 0.5915
MulticlassAccuracy value on hold-out data: 0.5914999842643738
Epoch: 12</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1712540884971618
Accuracy on hold-out set: 0.58955
MulticlassAccuracy value on hold-out data: 0.5895500183105469
Epoch: 13</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1461831785202026
Accuracy on hold-out set: 0.59495
MulticlassAccuracy value on hold-out data: 0.5949500203132629
Epoch: 14</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.136024131679535
Accuracy on hold-out set: 0.6035
MulticlassAccuracy value on hold-out data: 0.6035000085830688
Epoch: 15</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1744485748291016
Accuracy on hold-out set: 0.59685
MulticlassAccuracy value on hold-out data: 0.5968499779701233
Epoch: 16</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.151477359199524
Accuracy on hold-out set: 0.5935
MulticlassAccuracy value on hold-out data: 0.593500018119812
Returned to Spot: Validation loss: 1.151477359199524
----------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loss on hold-out set: 1.1276507280505121
Accuracy on hold-out set: 0.6006
MulticlassAccuracy value on hold-out data: 0.600600004196167
Final evaluation: Validation loss: 1.1276507280505121
Final evaluation: Validation metric: 0.600600004196167
----------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>(1.1276507280505121, nan, tensor(0.6006))</code></pre>
</div>
</div>
</section>
<section id="detailed-hyperparameter-plots" class="level3" data-number="13.14.5">
<h3 data-number="13.14.5" class="anchored" data-anchor-id="detailed-hyperparameter-plots"><span class="header-section-number">13.14.5</span> Detailed Hyperparameter Plots</h3>
<p>The contour plots in this section visualize the interactions of the three most important hyperparameters. Since some of these hyperparameters take fatorial or integer values, sometimes step-like fitness landcapes (or response surfaces) are generated. SPOT draws the interactions of the main hyperparameters by default. It is also possible to visualize all interactions.</p>
<div class="cell" data-fig-label="fig-contour" data-execution_count="31">
<div class="sourceCode cell-code" id="cb351"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">"./figures/"</span> <span class="op">+</span> experiment_name</span>
<span id="cb351-2"><a href="#cb351-2" aria-hidden="true" tabindex="-1"></a>spot_tuner.plot_important_hyperparameter_contour(filename<span class="op">=</span>filename)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>l1:  5.61786788811698
l2:  6.134164172253628
batch_size:  0.6312892162051759
epochs:  100.0
optimizer:  0.048227370836895544</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="14_spot_ray_hpt_torch_cifar10_files/figure-html/cell-32-output-2.png" width="704" height="281" class="figure-img"></p>
<figcaption class="figure-caption">Contour plots.</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<p><img src="14_spot_ray_hpt_torch_cifar10_files/figure-html/cell-32-output-3.png" width="704" height="281"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="14_spot_ray_hpt_torch_cifar10_files/figure-html/cell-32-output-4.png" width="712" height="281"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="14_spot_ray_hpt_torch_cifar10_files/figure-html/cell-32-output-5.png" width="703" height="281"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="14_spot_ray_hpt_torch_cifar10_files/figure-html/cell-32-output-6.png" width="703" height="281"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="14_spot_ray_hpt_torch_cifar10_files/figure-html/cell-32-output-7.png" width="712" height="281"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="14_spot_ray_hpt_torch_cifar10_files/figure-html/cell-32-output-8.png" width="700" height="281"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="14_spot_ray_hpt_torch_cifar10_files/figure-html/cell-32-output-9.png" width="717" height="281"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="14_spot_ray_hpt_torch_cifar10_files/figure-html/cell-32-output-10.png" width="700" height="281"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="14_spot_ray_hpt_torch_cifar10_files/figure-html/cell-32-output-11.png" width="700" height="281"></p>
</div>
</div>
<p>The figures (<span class="quarto-unresolved-ref">?fig-contour</span>) show the contour plots of the loss as a function of the hyperparameters. These plots are very helpful for benchmark studies and for understanding neural networks. <code>spotPython</code> provides additional tools for a visual inspection of the results and give valuable insights into the hyperparameter tuning process. This is especially useful for model explainability, transparency, and trustworthiness. In addition to the contour plots, <span class="quarto-unresolved-ref">?fig-parallel</span> shows the parallel plot of the hyperparameters.</p>
<div class="cell" data-fig-label="fig-parallel" data-execution_count="32">
<div class="sourceCode cell-code" id="cb353"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a>spot_tuner.parallel_plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="4c2cf0ae-5a47-44e4-9997-89fbb382ff03" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("4c2cf0ae-5a47-44e4-9997-89fbb382ff03")) {                    Plotly.newPlot(                        "4c2cf0ae-5a47-44e4-9997-89fbb382ff03",                        [{"dimensions":[{"label":"l1","range":[2.0,9.0],"values":[6.0,4.0,5.0,3.0,7.0,9.0,3.0,8.0,8.0,2.0,6.0,6.0,6.0,6.0,2.0,9.0,4.0,5.0,5.0,5.0,6.0,3.0]},{"label":"l2","range":[2.0,9.0],"values":[4.0,7.0,3.0,6.0,5.0,4.0,3.0,6.0,9.0,8.0,5.0,4.0,6.0,6.0,6.0,9.0,7.0,6.0,6.0,7.0,2.0,9.0]},{"label":"batch_size","range":[1.0,5.0],"values":[4.0,2.0,3.0,2.0,3.0,2.0,4.0,4.0,1.0,5.0,4.0,4.0,4.0,4.0,5.0,4.0,4.0,4.0,5.0,5.0,3.0,4.0]},{"label":"epochs","range":[3.0,4.0],"values":[4.0,4.0,3.0,3.0,4.0,4.0,3.0,3.0,3.0,4.0,4.0,4.0,4.0,4.0,4.0,4.0,4.0,4.0,4.0,4.0,3.0,4.0]},{"label":"optimizer","range":[0.0,8.0],"values":[6.0,6.0,5.0,4.0,3.0,8.0,1.0,8.0,3.0,0.0,3.0,3.0,6.0,3.0,3.0,3.0,3.0,3.0,3.0,3.0,3.0,6.0]}],"line":{"cmax":2.305777049589157,"cmin":1.1112337918281556,"color":[1.2120959482431413,1.3770421450687573,1.5594049923419953,1.3404605934880673,1.2409861245393754,2.305777049589157,1.6722080268859862,1.9520383694648742,1.5469318324963246,1.3407153537750245,1.19343827252388,1.2590364922046662,1.2709592715501785,1.173101697587967,1.2586891078948974,1.4033361210107804,1.1767093319892883,1.1590280144691467,1.1112337918281556,1.1175544973373412,2.3031554979324342,1.2154606033802033],"colorscale":[[0.0,"rgb(0,0,131)"],[0.2,"rgb(0,60,170)"],[0.4,"rgb(5,255,255)"],[0.6,"rgb(255,255,0)"],[0.8,"rgb(250,0,0)"],[1.0,"rgb(128,0,0)"]],"showscale":true},"type":"parcoords"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('4c2cf0ae-5a47-44e4-9997-89fbb382ff03');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
<p>Parallel coordinates plots</p>
</div>
</div>
</section>
</section>
<section id="sec-summary" class="level2" data-number="13.15">
<h2 data-number="13.15" class="anchored" data-anchor-id="sec-summary"><span class="header-section-number">13.15</span> Summary and Outlook</h2>
<p>This tutorial presents the hyperparameter tuning open source software <code>spotPython</code> for <code>PyTorch</code>. To show its basic features, a comparison with the “official” <code>PyTorch</code> hyperparameter tuning tutorial <span class="citation" data-cites="pyto23a">(<a href="references.html#ref-pyto23a" role="doc-biblioref">PyTorch 2023a</a>)</span> is presented. Some of the advantages of <code>spotPython</code> are:</p>
<ul>
<li>Numerical and categorical hyperparameters.</li>
<li>Powerful surrogate models.</li>
<li>Flexible approach and easy to use.</li>
<li>Simple JSON files for the specification of the hyperparameters.</li>
<li>Extension of default and user specified network classes.</li>
<li>Noise handling techniques.</li>
<li>Interaction with <code>tensorboard</code>.</li>
</ul>
<p>Currently, only rudimentary parallel and distributed neural network training is possible, but these capabilities will be extended in the future. The next version of <code>spotPython</code> will also include a more detailed documentation and more examples.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Important: This tutorial does not present a complete benchmarking study <span class="citation" data-cites="bart20gArxiv">(<a href="references.html#ref-bart20gArxiv" role="doc-biblioref">Bartz-Beielstein et al. 2020</a>)</span>. The results are only preliminary and highly dependent on the local configuration (hard- and software). Our goal is to provide a first impression of the performance of the hyperparameter tuning package <code>spotPython</code>. To demonstrate its capabilities, a quick comparison with <code>ray[tune]</code> was performed. <code>ray[tune]</code> was chosen, because it is presented as “an industry standard tool for distributed hyperparameter tuning.” The results should be interpreted with care.</p>
</div>
</div>
</section>
<section id="sec-appendix" class="level2" data-number="13.16">
<h2 data-number="13.16" class="anchored" data-anchor-id="sec-appendix"><span class="header-section-number">13.16</span> Appendix</h2>
<section id="sample-output-from-ray-tunes-run" class="level3" data-number="13.16.1">
<h3 data-number="13.16.1" class="anchored" data-anchor-id="sample-output-from-ray-tunes-run"><span class="header-section-number">13.16.1</span> Sample Output From Ray Tune’s Run</h3>
<p>The output from <code>ray[tune]</code> could look like this <span class="citation" data-cites="pyto23b">(<a href="references.html#ref-pyto23b" role="doc-biblioref">PyTorch 2023b</a>)</span>:</p>
<pre class="{raw}"><code>Number of trials: 10 (10 TERMINATED)
------+------+-------------+--------------+---------+------------+--------------------+
|   l1 |   l2 |          lr |   batch_size |    loss |   accuracy | training_iteration |
+------+------+-------------+--------------+---------+------------+--------------------|
|   64 |    4 | 0.00011629  |            2 | 1.87273 |     0.244  |                  2 |
|   32 |   64 | 0.000339763 |            8 | 1.23603 |     0.567  |                  8 |
|    8 |   16 | 0.00276249  |           16 | 1.1815  |     0.5836 |                 10 |
|    4 |   64 | 0.000648721 |            4 | 1.31131 |     0.5224 |                  8 |
|   32 |   16 | 0.000340753 |            8 | 1.26454 |     0.5444 |                  8 |
|    8 |    4 | 0.000699775 |            8 | 1.99594 |     0.1983 |                  2 |
|  256 |    8 | 0.0839654   |           16 | 2.3119  |     0.0993 |                  1 |
|   16 |  128 | 0.0758154   |           16 | 2.33575 |     0.1327 |                  1 |
|   16 |    8 | 0.0763312   |           16 | 2.31129 |     0.1042 |                  4 |
|  128 |   16 | 0.000124903 |            4 | 2.26917 |     0.1945 |                  1 |
+-----+------+------+-------------+--------------+---------+------------+--------------------+
Best trial config: {'l1': 8, 'l2': 16, 'lr': 0.00276249, 'batch_size': 16, 'data_dir': '...'}
Best trial final validation loss: 1.181501
Best trial final validation accuracy: 0.5836
Best trial test set accuracy: 0.5806</code></pre>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-bart21i" class="csl-entry" role="listitem">
Bartz, Eva, Thomas Bartz-Beielstein, Martin Zaefferer, and Olaf Mersmann, eds. 2022. <em><span class="nocase">Hyperparameter Tuning for Machine and Deep Learning with R - A Practical Guide</span></em>. Springer.
</div>
<div id="ref-bart20gArxiv" class="csl-entry" role="listitem">
Bartz-Beielstein, Thomas, Carola Doerr, Jakob Bossek, Sowmya Chandrasekaran, Tome Eftimov, Andreas Fischbach, Pascal Kerschke, et al. 2020. <span>“Benchmarking in Optimization: Best Practice and Open Issues.”</span> arXiv. <a href="https://arxiv.org/abs/2007.03488">https://arxiv.org/abs/2007.03488</a>.
</div>
<div id="ref-mont20a" class="csl-entry" role="listitem">
Montiel, Jacob, Max Halford, Saulo Martiello Mastelini, Geoffrey Bolmier, Raphael Sourty, Robin Vaysse, Adil Zouitine, et al. 2021. <span>“River: Machine Learning for Streaming Data in Python.”</span>
</div>
<div id="ref-pyto23a" class="csl-entry" role="listitem">
PyTorch. 2023a. <span>“Hyperparameter Tuning with Ray Tune.”</span> <a href="https://pytorch.org/tutorials/beginner/hyperparameter_tuning_tutorial.html">https://pytorch.org/tutorials/beginner/hyperparameter_tuning_tutorial.html</a>.
</div>
<div id="ref-pyto23b" class="csl-entry" role="listitem">
———. 2023b. <span>“Training a Classifier.”</span> <a href="https://pytorch.org/tutorials/beginner/blitz/cifar10_tutorial.html">https://pytorch.org/tutorials/beginner/blitz/cifar10_tutorial.html</a>.
</div>
</div>
</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Alternatively, the source code can be downloaded from gitHub: <a href="https://github.com/sequential-parameter-optimization/spotPython">https://github.com/sequential-parameter-optimization/spotPython</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>We were not able to install <code>Ray Tune</code> on our system. Therefore, we used the results from the <code>PyTorch</code> tutorial.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./12_spot_hpt_torch_cifar10.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">HPT: PyTorch With cifar10 Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./16_spot_hpt_sklearn_multiclass_classification_randomforest.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">HPT: sklearn RandomForestClassifier VBDP Data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>